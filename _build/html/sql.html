
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>5. SQL 기초 배워보기 &#8212; 파이썬을 이용한 퀀트 투자 포트폴리오 만들기</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script kind="utterances">

    var commentsRunWhenDOMLoaded = cb => {
    if (document.readyState != 'loading') {
        cb()
    } else if (document.addEventListener) {
        document.addEventListener('DOMContentLoaded', cb)
    } else {
        document.attachEvent('onreadystatechange', function() {
        if (document.readyState == 'complete') cb()
        })
    }
}

var addUtterances = () => {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src = "https://utteranc.es/client.js";
    script.async = "async";

    script.setAttribute("repo", "hyunyulhenry/quant_py");
    script.setAttribute("issue-term", "pathname");
    script.setAttribute("theme", "github-light");
    script.setAttribute("label", "💬 comment");
    script.setAttribute("crossorigin", "anonymous");

    sections = document.querySelectorAll("div.section");
    if (sections !== null) {
        section = sections[sections.length-1];
        section.appendChild(script);
    }
}
commentsRunWhenDOMLoaded(addUtterances);
</script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="6. 파이썬에서 SQL 연결하기" href="sql_in_python.html" />
    <link rel="prev" title="4. 데이터 시각화 배워보기" href="plot.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">파이썬을 이용한 퀀트 투자 포트폴리오 만들기</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="index.html">
   파이썬을 이용한 퀀트 투자 포트폴리오 만들기
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  퀀트와 프로그래밍 기초 배워보기
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="quant_intro.html">
   1. 퀀트에 대해 알아보기
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="python.html">
   2. 파이썬 기초 배워보기
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="eda.html">
   3. 데이터 분석 배워보기
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="plot.html">
   4. 데이터 시각화 배워보기
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   5. SQL 기초 배워보기
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="sql_in_python.html">
   6. 파이썬에서 SQL 연결하기
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  크롤링을 이용한 데이터 수집
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="web.html">
   7. 크롤링을 위한 웹 기본지식
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="crawl_basic.html">
   8. 정적 크롤링 실습하기
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="selenium.html">
   9. 동적 크롤링과 정규 표현식
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="data_korea.html">
   10. 국내 주식 데이터 수집
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="data_global.html">
   11. 전 세계 주식 데이터 수집하기
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="data_ref.html">
   12. 투자 참고용 데이터 수집
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  포트폴리오 구성, 백테스트 및 매매하기
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="factor.html">
   13. 퀀트 전략을 이용한 종목선정
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="portfolio.html">
   14. 포트폴리오 구성 전략
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="technical.html">
   15. 트레이딩을 위한 기술적 지표
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="backtest.html">
   16. 백테스팅 시뮬레이션
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="api_trading.html">
   17. 증권사 API 연결과 매매하기
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  부록
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="install_python.html">
   파이썬 다운로드 및 설치하기
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="install_sql.html">
   SQL 다운로드 및 설치하기
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/sql.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/hyunyulhenry/quant_py"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/hyunyulhenry/quant_py/issues/new?title=Issue%20on%20page%20%2Fsql.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/hyunyulhenry/quant_py/main?urlpath=tree/sql.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id1">
   5.1. 데이터베이스와 테이블 만들기
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id2">
     5.1.1. 테이블 정의 변경하기
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id3">
     5.1.2. 테이블에 데이터 등록하기
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id4">
   5.2. SQL 기초구문 익히기
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#select">
     5.2.1.
     <code class="docutils literal notranslate">
      <span class="pre">
       select
      </span>
     </code>
     : 열 선택하기
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#distinct">
     5.2.2.
     <code class="docutils literal notranslate">
      <span class="pre">
       distinct
      </span>
     </code>
     : 중복 제거하기
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#where">
     5.2.3.
     <code class="docutils literal notranslate">
      <span class="pre">
       where
      </span>
     </code>
     : 원하는 행 선택하기
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id8">
   5.3. 연산자
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id9">
     5.3.1. 산술 연산자
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id10">
     5.3.2. 비교 연산자
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id11">
     5.3.3. 논리 연산자
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id12">
   5.4. 집약 함수
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#count">
     5.4.1.
     <code class="docutils literal notranslate">
      <span class="pre">
       count
      </span>
     </code>
     : 행 숫자를 계산
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sum">
     5.4.2.
     <code class="docutils literal notranslate">
      <span class="pre">
       sum
      </span>
     </code>
     : 합계를 계산
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#avg">
     5.4.3.
     <code class="docutils literal notranslate">
      <span class="pre">
       avg
      </span>
     </code>
     : 산술평균을 계산
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id16">
     5.4.4. 중복값 제외 후 집약함수 사용하기
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id17">
   5.5. 그룹화와 정렬
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id18">
     5.5.1. 그룹 나누기
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id19">
     5.5.2. 검색 결과 정렬하기
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id20">
   5.6. 뷰와 서브쿼리
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id21">
     5.6.1. 뷰 만들기
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id22">
     5.6.2. 뷰 삭제하기
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id23">
     5.6.3. 서브쿼리
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id24">
     5.6.4. 스칼라 서브쿼리
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#case">
   5.7. 함수, 술어와 case 식
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id25">
     5.7.1. 산술 함수
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#abs">
       5.7.1.1.
       <code class="docutils literal notranslate">
        <span class="pre">
         abs
        </span>
       </code>
       : 절대값 계산하기
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#mod">
       5.7.1.2.
       <code class="docutils literal notranslate">
        <span class="pre">
         mod
        </span>
       </code>
       : 나눗셈의 나머지 구하기
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#round">
     5.7.2.
     <code class="docutils literal notranslate">
      <span class="pre">
       round
      </span>
     </code>
     : 반올림 하기
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id29">
     5.7.3. 문자열 함수
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#concat">
       5.7.3.1.
       <code class="docutils literal notranslate">
        <span class="pre">
         concat
        </span>
       </code>
       : 문자열 연결
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#lower">
       5.7.3.2.
       <code class="docutils literal notranslate">
        <span class="pre">
         lower
        </span>
       </code>
       : 소문자로 변환
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#replace">
       5.7.3.3.
       <code class="docutils literal notranslate">
        <span class="pre">
         replace
        </span>
       </code>
       : 문자를 변경
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id33">
     5.7.4. 날짜 함수
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id34">
       5.7.4.1. 현재 날짜, 시간, 일시
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id35">
       5.7.4.2. 날짜 요소 추출하기
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id36">
     5.7.5. 술어
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#like">
       5.7.5.1.
       <code class="docutils literal notranslate">
        <span class="pre">
         like
        </span>
       </code>
       : 문자열 부분 일치
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#between">
       5.7.5.2.
       <code class="docutils literal notranslate">
        <span class="pre">
         between
        </span>
       </code>
       : 범위 검색
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#is-null-is-not-null-null">
       5.7.5.3.
       <code class="docutils literal notranslate">
        <span class="pre">
         is
        </span>
        <span class="pre">
         null
        </span>
       </code>
       ,
       <code class="docutils literal notranslate">
        <span class="pre">
         is
        </span>
        <span class="pre">
         not
        </span>
        <span class="pre">
         null
        </span>
       </code>
       : null 데이터 선택
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#in">
       5.7.5.4.
       <code class="docutils literal notranslate">
        <span class="pre">
         in
        </span>
       </code>
       : 복수의 값을 지정
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id39">
     5.7.6.
     <code class="docutils literal notranslate">
      <span class="pre">
       case
      </span>
     </code>
     식
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id41">
   5.8. 테이블의 집합과 결합
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id42">
     5.8.1. 테이블 더하기
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id43">
     5.8.2. 테이블 결합
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#inner-join">
       5.8.2.1.
       <code class="docutils literal notranslate">
        <span class="pre">
         inner
        </span>
        <span class="pre">
         join
        </span>
       </code>
       : 내부 결합
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#outer-join">
       5.8.2.2.
       <code class="docutils literal notranslate">
        <span class="pre">
         outer
        </span>
        <span class="pre">
         join
        </span>
       </code>
       외부 결합
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id45">
   5.9. SQL 고급 처리
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id46">
     5.9.1. 윈도우 함수
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#rank">
       5.9.1.1.
       <code class="docutils literal notranslate">
        <span class="pre">
         rank
        </span>
       </code>
       : 순위를 계산
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id47">
       5.9.1.2. 윈도우 함수에서 집약 함수의 사용
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id48">
       5.9.1.3. 이동평균 계산하기
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#grouping">
     5.9.2. GROUPING 연산자
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>SQL 기초 배워보기</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id1">
   5.1. 데이터베이스와 테이블 만들기
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id2">
     5.1.1. 테이블 정의 변경하기
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id3">
     5.1.2. 테이블에 데이터 등록하기
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id4">
   5.2. SQL 기초구문 익히기
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#select">
     5.2.1.
     <code class="docutils literal notranslate">
      <span class="pre">
       select
      </span>
     </code>
     : 열 선택하기
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#distinct">
     5.2.2.
     <code class="docutils literal notranslate">
      <span class="pre">
       distinct
      </span>
     </code>
     : 중복 제거하기
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#where">
     5.2.3.
     <code class="docutils literal notranslate">
      <span class="pre">
       where
      </span>
     </code>
     : 원하는 행 선택하기
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id8">
   5.3. 연산자
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id9">
     5.3.1. 산술 연산자
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id10">
     5.3.2. 비교 연산자
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id11">
     5.3.3. 논리 연산자
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id12">
   5.4. 집약 함수
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#count">
     5.4.1.
     <code class="docutils literal notranslate">
      <span class="pre">
       count
      </span>
     </code>
     : 행 숫자를 계산
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sum">
     5.4.2.
     <code class="docutils literal notranslate">
      <span class="pre">
       sum
      </span>
     </code>
     : 합계를 계산
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#avg">
     5.4.3.
     <code class="docutils literal notranslate">
      <span class="pre">
       avg
      </span>
     </code>
     : 산술평균을 계산
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id16">
     5.4.4. 중복값 제외 후 집약함수 사용하기
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id17">
   5.5. 그룹화와 정렬
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id18">
     5.5.1. 그룹 나누기
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id19">
     5.5.2. 검색 결과 정렬하기
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id20">
   5.6. 뷰와 서브쿼리
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id21">
     5.6.1. 뷰 만들기
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id22">
     5.6.2. 뷰 삭제하기
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id23">
     5.6.3. 서브쿼리
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id24">
     5.6.4. 스칼라 서브쿼리
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#case">
   5.7. 함수, 술어와 case 식
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id25">
     5.7.1. 산술 함수
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#abs">
       5.7.1.1.
       <code class="docutils literal notranslate">
        <span class="pre">
         abs
        </span>
       </code>
       : 절대값 계산하기
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#mod">
       5.7.1.2.
       <code class="docutils literal notranslate">
        <span class="pre">
         mod
        </span>
       </code>
       : 나눗셈의 나머지 구하기
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#round">
     5.7.2.
     <code class="docutils literal notranslate">
      <span class="pre">
       round
      </span>
     </code>
     : 반올림 하기
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id29">
     5.7.3. 문자열 함수
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#concat">
       5.7.3.1.
       <code class="docutils literal notranslate">
        <span class="pre">
         concat
        </span>
       </code>
       : 문자열 연결
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#lower">
       5.7.3.2.
       <code class="docutils literal notranslate">
        <span class="pre">
         lower
        </span>
       </code>
       : 소문자로 변환
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#replace">
       5.7.3.3.
       <code class="docutils literal notranslate">
        <span class="pre">
         replace
        </span>
       </code>
       : 문자를 변경
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id33">
     5.7.4. 날짜 함수
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id34">
       5.7.4.1. 현재 날짜, 시간, 일시
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id35">
       5.7.4.2. 날짜 요소 추출하기
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id36">
     5.7.5. 술어
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#like">
       5.7.5.1.
       <code class="docutils literal notranslate">
        <span class="pre">
         like
        </span>
       </code>
       : 문자열 부분 일치
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#between">
       5.7.5.2.
       <code class="docutils literal notranslate">
        <span class="pre">
         between
        </span>
       </code>
       : 범위 검색
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#is-null-is-not-null-null">
       5.7.5.3.
       <code class="docutils literal notranslate">
        <span class="pre">
         is
        </span>
        <span class="pre">
         null
        </span>
       </code>
       ,
       <code class="docutils literal notranslate">
        <span class="pre">
         is
        </span>
        <span class="pre">
         not
        </span>
        <span class="pre">
         null
        </span>
       </code>
       : null 데이터 선택
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#in">
       5.7.5.4.
       <code class="docutils literal notranslate">
        <span class="pre">
         in
        </span>
       </code>
       : 복수의 값을 지정
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id39">
     5.7.6.
     <code class="docutils literal notranslate">
      <span class="pre">
       case
      </span>
     </code>
     식
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id41">
   5.8. 테이블의 집합과 결합
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id42">
     5.8.1. 테이블 더하기
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id43">
     5.8.2. 테이블 결합
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#inner-join">
       5.8.2.1.
       <code class="docutils literal notranslate">
        <span class="pre">
         inner
        </span>
        <span class="pre">
         join
        </span>
       </code>
       : 내부 결합
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#outer-join">
       5.8.2.2.
       <code class="docutils literal notranslate">
        <span class="pre">
         outer
        </span>
        <span class="pre">
         join
        </span>
       </code>
       외부 결합
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id45">
   5.9. SQL 고급 처리
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id46">
     5.9.1. 윈도우 함수
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#rank">
       5.9.1.1.
       <code class="docutils literal notranslate">
        <span class="pre">
         rank
        </span>
       </code>
       : 순위를 계산
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id47">
       5.9.1.2. 윈도우 함수에서 집약 함수의 사용
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id48">
       5.9.1.3. 이동평균 계산하기
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#grouping">
     5.9.2. GROUPING 연산자
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="sql">
<h1><span class="section-number">5. </span>SQL 기초 배워보기<a class="headerlink" href="#sql" title="Permalink to this headline">¶</a></h1>
<p>데이터베이스는 각각의 테이블로 이루어져 있으며, 테이블의 구성요소는 크게 다음과 같다.</p>
<ul class="simple">
<li><p>열(컬럼): 테이블에 보관하는 데이터 항목이다.</p></li>
<li><p>행(레코드): 데이터 한 건에 해당하며, RDBMS는 반드시 행 단위로 데이터를 읽고 쓴다.</p></li>
<li><p>셀(값): 행과 열이 교차하는 하나의 값이며, 하나의 셀 안에는 하나의 데이터만 넣을 수 있다.</p></li>
</ul>
<div class="figure align-default" id="table">
<img alt="_images/table.png" src="_images/table.png" />
<p class="caption"><span class="caption-number">Fig. 5.1 </span><span class="caption-text">테이블의 구성요소</span><a class="headerlink" href="#table" title="Permalink to this image">¶</a></p>
</div>
<div class="section" id="id1">
<h2><span class="section-number">5.1. </span>데이터베이스와 테이블 만들기<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>먼저 각각의 테이블이 저장될 데이터베이스(스키마)를 만들어 보도록 하자. MySQL Workbench를 열어 아래의 쿼리를 입력한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">create</span> <span class="n">database</span> <span class="n">shop</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="create-schema">
<img alt="_images/create_schema.png" src="_images/create_schema.png" />
<p class="caption"><span class="caption-number">Fig. 5.2 </span><span class="caption-text">데이터베이스 만들기</span><a class="headerlink" href="#create-schema" title="Permalink to this image">¶</a></p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">create</span> <span class="pre">database</span> <span class="pre">[데이터베이스명]</span></code>은 데이터베이스를 만드는 SQL 쿼리다. 쿼리를 실행하는 방법은 원하는 부분을 선택한 후 Ctrl + Shift + Enter(맥 사용자의 경우  Modifier + Shift + Return) 키를 누른다. SQL 쿼리문의 끝에는 세미콜론(;)을 붙이며, 대문자나 소문자는 구분하지 않는다. 단 테이블에 등록된 데이터는 대/소문자가 구분된다.</p>
<p>쿼리가 실행되면 하단의 [Action Output] 부분에 <strong>create database shop</strong> 이라는 문구가 뜨며, shop이라는 데이터베이스가 만들어졌음을 알 수 있다. 이를 확인할 수 있는 방법은 <a class="reference internal" href="#check-schema"><span class="std std-numref">Fig. 5.3</span></a>와 같이 [Navigator]부분 하단에서 [Schemas]를 선택한 후 우측 상단의 새로고침 마크를 클릭하면 shop 데이터베이스가 생겼음이 확인된다.</p>
<div class="figure align-default" id="check-schema">
<img alt="_images/check_schema.png" src="_images/check_schema.png" />
<p class="caption"><span class="caption-number">Fig. 5.3 </span><span class="caption-text">데이터베이스 확인하기</span><a class="headerlink" href="#check-schema" title="Permalink to this image">¶</a></p>
</div>
<p>데이터베이스를 만들고 난 후에는 사용하고자 하는 데이터베이스를 지정해야하며, 이는 MySQL을 새로 열때마다 실행해야 한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">use</span> <span class="n">shop</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">use</span> <span class="pre">[데이터베이스명];</span></code> 쿼리를 통해 shop 데이터베이스를 사용할 것을 지정하였다.</p>
<p>이제 데이터베이스 하부에 테이블을 만들어보도록 하자. 테이블을 만드는 쿼리 형식은 다음과 같다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>create table &lt;테이블명&gt;
(
&lt;열 이름 1&gt; &lt;데이터 형태&gt; &lt;이 열의 제약&gt;,
&lt;열 이름 2&gt; &lt;데이터 형태&gt; &lt;이 열의 제약&gt;,
&lt;열 이름 3&gt; &lt;데이터 형태&gt; &lt;이 열의 제약&gt;,
….
&lt;테이블의 제약 1&gt;, &lt;테이블의 제약 2&gt;, …. 
);
</pre></div>
</div>
</div>
</div>
<p>위 형식에 맞춰 goods 테이블을 만들어주도록 한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">create</span> <span class="n">table</span> <span class="n">goods</span>
<span class="p">(</span>
<span class="n">goods_id</span> <span class="n">char</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="ow">not</span> <span class="n">null</span><span class="p">,</span>
<span class="n">goods_name</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="ow">not</span> <span class="n">null</span><span class="p">,</span>
<span class="n">goods_classify</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span> <span class="ow">not</span> <span class="n">null</span><span class="p">,</span>
<span class="n">sell_price</span> <span class="n">integer</span><span class="p">,</span>
<span class="n">buy_price</span> <span class="n">integer</span><span class="p">,</span>
<span class="n">register_date</span> <span class="n">date</span><span class="p">,</span>
<span class="n">primary</span> <span class="n">key</span> <span class="p">(</span><span class="n">goods_id</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>모든 열에 integer나 char 등의 데이터 형식을 지정해 주어야 한다. MySQL에서 사용할 수 있는 데이터 타입의 종류는 크게 CHAR, BINARY, TEXT, VARCHAR, BLOB, 숫자형 데이터 타입이 있으며, 입력되는 데이터에 맞는 타입을 설정한다. 또한 각종 제약을 설정해줄 수 있다. null이란 데이터가 없음을 의미하며, not null은 반드시 데이터가 존재해야 한다는 의미이다. 마지막으로 goods_id 열을 기본 키(primary key)로 지정해준다.</p>
<p>위 쿼리를 실행한 후 좌측의 SCHEMAS 부분에서 새로고침을 해보면, shop 데이터베이스의 Tables에 [goods]가 생성되며, Columns 부분에서 우리가 입력한 열들을 확인할 수 있다. 또한 열 이름을 클릭하면 하단의 Information 부분에서 해당 열의 데이터 타입 또한 확인할 수 있다.</p>
<div class="figure align-default" id="goods-table">
<img alt="_images/goods_table.png" src="_images/goods_table.png" />
<p class="caption"><span class="caption-number">Fig. 5.4 </span><span class="caption-text">테이블 확인하기</span><a class="headerlink" href="#goods-table" title="Permalink to this image">¶</a></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>데이터베이스나 테이블, 열 이름으로 사용할 수 있는 문자는 다음과 같다.</p>
<ul class="simple">
<li><p>영문자(간혹 한글이 되기는 하나 추천하지 않음)</p></li>
<li><p>숫자</p></li>
<li><p>언더바(_)</p></li>
</ul>
</div>
<div class="section" id="id2">
<h3><span class="section-number">5.1.1. </span>테이블 정의 변경하기<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>테이블에 열을 추가로 만들거나 삭제를 해야하는 등 테이블의 정의를 변경해야 하는 경우 <code class="docutils literal notranslate"><span class="pre">ALTER</span> <span class="pre">TABLE</span></code> 문을 사용하면 된다. 먼저 열을 추가하는 쿼리는 다음과 같다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">alter</span> <span class="n">table</span> <span class="o">&lt;</span><span class="n">테이블명</span><span class="o">&gt;</span> <span class="n">add</span> <span class="n">column</span> <span class="o">&lt;</span><span class="n">열</span> <span class="n">이름</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">열</span> <span class="n">정의</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<p>shop 테이블에 goods_name이라는 열을 추가하며, 데이터 타입은 varchar(100)으로 설정하는 쿼리는 다음과 같다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">alter</span> <span class="n">table</span> <span class="n">goods</span> <span class="n">add</span> <span class="n">column</span> <span class="n">goods_name_eng</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>쿼리를 실행하고 SCHEMAS 부분에서 새로고침을 누르면 shop 데이터베이스 내 goods 테이블에 goods_name_eng 열이 추가된 것이 확인된다.</p>
<div class="figure align-default" id="add-col">
<img alt="_images/add_col.png" src="_images/add_col.png" />
<p class="caption"><span class="caption-number">Fig. 5.5 </span><span class="caption-text">테이블에 열 추가하기</span><a class="headerlink" href="#add-col" title="Permalink to this image">¶</a></p>
</div>
<p>반대로 열을 삭제하는 쿼리는 다음과 같다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">alter</span> <span class="n">table</span> <span class="o">&lt;</span><span class="n">테이블명</span><span class="o">&gt;</span> <span class="n">drop</span> <span class="n">column</span> <span class="o">&lt;</span><span class="n">열명</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<p>이를 이용해 위에서 만든 goods_name_eng 열을 삭제하도록 한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">alter</span> <span class="n">table</span> <span class="n">goods</span> <span class="n">drop</span> <span class="n">column</span> <span class="n">goods_name_eng</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<p>쿼리 실행후 SCHEMAS 부분에서 새로고침을 누르면 goods 테이블에서 해당 열이 삭제된 것을 확인할 수 있다.</p>
</div>
<div class="section" id="id3">
<h3><span class="section-number">5.1.2. </span>테이블에 데이터 등록하기<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>현재 goods 테이블은 아무런 데이터가 없는 빈 테이블 상태이므로, 데이터를 등록해주어야 한다. SQL에서 데이터를 등록하는 쿼리는 다음과 같다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">insert</span> <span class="n">into</span> <span class="o">&lt;</span><span class="n">테이블명</span><span class="o">&gt;</span> <span class="n">values</span> <span class="p">(</span><span class="n">값</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>아래 쿼리를 입력하여 goods 테이블에 데이터를 등록해주도록 한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">insert</span> <span class="n">into</span> <span class="n">goods</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;0001&#39;</span><span class="p">,</span> <span class="s1">&#39;티셔츠&#39;</span><span class="p">,</span> <span class="s1">&#39;의류&#39;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="s1">&#39;2020-09-20&#39;</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">goods</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;0002&#39;</span><span class="p">,</span> <span class="s1">&#39;펀칭기&#39;</span><span class="p">,</span> <span class="s1">&#39;사무용품&#39;</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">320</span><span class="p">,</span> <span class="s1">&#39;2020-09-11&#39;</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">goods</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;0003&#39;</span><span class="p">,</span> <span class="s1">&#39;와이셔츠&#39;</span><span class="p">,</span> <span class="s1">&#39;의류&#39;</span><span class="p">,</span> <span class="mi">4000</span><span class="p">,</span> <span class="mi">2800</span><span class="p">,</span> <span class="n">NULL</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">goods</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;0004&#39;</span><span class="p">,</span> <span class="s1">&#39;식칼&#39;</span><span class="p">,</span> <span class="s1">&#39;주방용품&#39;</span><span class="p">,</span> <span class="mi">3000</span><span class="p">,</span> <span class="mi">2800</span><span class="p">,</span> <span class="s1">&#39;2020-09-20&#39;</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">goods</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;0005&#39;</span><span class="p">,</span> <span class="s1">&#39;압력솥&#39;</span><span class="p">,</span> <span class="s1">&#39;주방용품&#39;</span><span class="p">,</span> <span class="mi">6800</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="s1">&#39;2020-01-15&#39;</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">goods</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;0006&#39;</span><span class="p">,</span> <span class="s1">&#39;포크&#39;</span><span class="p">,</span> <span class="s1">&#39;주방용품&#39;</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="n">NULL</span><span class="p">,</span> <span class="s1">&#39;2020-09-20&#39;</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">goods</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;0007&#39;</span><span class="p">,</span> <span class="s1">&#39;도마&#39;</span><span class="p">,</span> <span class="s1">&#39;주방용품&#39;</span><span class="p">,</span> <span class="mi">880</span><span class="p">,</span> <span class="mi">790</span><span class="p">,</span> <span class="s1">&#39;2020-04-28&#39;</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">goods</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;0008&#39;</span><span class="p">,</span> <span class="s1">&#39;볼펜&#39;</span><span class="p">,</span> <span class="s1">&#39;사무용품&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">NULL</span><span class="p">,</span> <span class="s1">&#39;2020-11-11&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="add-data">
<img alt="_images/add_data.png" src="_images/add_data.png" />
<p class="caption"><span class="caption-number">Fig. 5.6 </span><span class="caption-text">데이터 추가하기</span><a class="headerlink" href="#add-data" title="Permalink to this image">¶</a></p>
</div>
<p>쿼리가 제대로 실행되었으면 하단의 Output 부분이 <a class="reference internal" href="#add-data"><span class="std std-numref">Fig. 5.6</span></a>와 같이 나타난다. 이 부분에서 SQL 초보자들에게 발생하는 대부분의 오류는 다음과 같다.</p>
<ul class="simple">
<li><p>한 번 입력한 데이터를 다시 입력(Error Code: 1062. Duplicate entry ‘000x’ for key ‘goods.PRIMARY’ 오류 메세지 발생)</p></li>
<li><p>테이블 내 열의 갯수와 입력하는 데이터의 열 갯수가 같지 않음(Error Code: 1136. Column count doesn’t match value count at row 1	오류 메세지 발생)</p></li>
</ul>
<p>이 외에도 발생하는 오류들은 하단의 Output 부분에 그 원인이 있으므로, 당황하지 말고 해당 메세지를 살펴보고 수정하면 된다.</p>
</div>
</div>
<div class="section" id="id4">
<h2><span class="section-number">5.2. </span>SQL 기초구문 익히기<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p>위에서 만든 테이블을 바탕으로 SQL에서 자주 사용되는 기초 구문들을 실습해보겠다.</p>
<div class="section" id="select">
<h3><span class="section-number">5.2.1. </span><code class="docutils literal notranslate"><span class="pre">select</span></code>: 열 선택하기<a class="headerlink" href="#select" title="Permalink to this headline">¶</a></h3>
<p>테이블에서 원하는 열을 선택할 때는 <code class="docutils literal notranslate"><span class="pre">select</span></code> 문을 사용하며, 쿼리는 다음과 같다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>select &lt;열 이름 1&gt; , &lt;열 이름 2&gt;, … &lt;열 이름 n&gt;
from &lt;테이블명&gt;;
</pre></div>
</div>
</div>
</div>
<p>goods 테이블 중 goods_id, goods_name, buy_price 열만 선택해보도록 하자.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">goods_id</span><span class="p">,</span> <span class="n">goods_name</span><span class="p">,</span> <span class="n">buy_price</span>
<span class="kn">from</span> <span class="nn">goods</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="id5">
<img alt="_images/select.png" src="_images/select.png" />
<p class="caption"><span class="caption-number">Fig. 5.7 </span><span class="caption-text">열 선택하기</span><a class="headerlink" href="#id5" title="Permalink to this image">¶</a></p>
</div>
<p>쿼리를 실행하면 하단의 [Result Grid]에 결과가 표시되며, 우리가 선택한 열만 표시된다. 만일 모든 데이터를 한번에 보고 싶다면 <code class="docutils literal notranslate"><span class="pre">select</span> <span class="pre">*</span> <span class="pre">from</span> <span class="pre">&lt;테이블명&gt;;</span></code> 형태로 입력하면 된다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="o">*</span> <span class="kn">from</span> <span class="nn">goods</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="select-all">
<img alt="_images/select_all.png" src="_images/select_all.png" />
<p class="caption"><span class="caption-number">Fig. 5.8 </span><span class="caption-text">모든 열 출력하기</span><a class="headerlink" href="#select-all" title="Permalink to this image">¶</a></p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">as</span></code> 키워드를 사용하면 열에 별명을 부여할 수도 있다. 만일 저장된 테이블의 열 이름이 길 경우 이를 모두 출력하면 직관적으로 내용을 이해하기 힘드므로 이름을 간결하게 변경하는 것이 나을 때도 있다. as 키워드를 사용하는 방법은 다음과 같다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="o">&lt;</span><span class="n">열</span> <span class="n">이름</span> <span class="mi">1</span><span class="o">&gt;</span> <span class="k">as</span> <span class="o">&lt;</span><span class="n">별명</span><span class="o">&gt;</span>
<span class="kn">from</span> <span class="o">&lt;</span><span class="n">테이블명</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<p>이를 이용해 goods_id, goods_name, buy_price의 이름을 바꾼 후 출력해보도록 하자.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">goods_id</span> <span class="k">as</span> <span class="nb">id</span><span class="p">,</span>
	<span class="n">goods_name</span> <span class="k">as</span> <span class="n">name</span><span class="p">,</span>
	<span class="n">buy_price</span> <span class="k">as</span> <span class="n">price</span>
<span class="kn">from</span> <span class="nn">goods</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="select-as">
<img alt="_images/select_as.png" src="_images/select_as.png" />
<p class="caption"><span class="caption-number">Fig. 5.9 </span><span class="caption-text">열에 별명 부여하기</span><a class="headerlink" href="#select-as" title="Permalink to this image">¶</a></p>
</div>
<p>select 구를 통해 단순히 현재 있는 열을 선택할 뿐만 아니라 상수 및 계산식도 작성이 가능하다. 아래 쿼리를 실행해보도록 하자.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="s1">&#39;상품&#39;</span> <span class="k">as</span> <span class="n">category</span><span class="p">,</span>
    <span class="mi">38</span> <span class="k">as</span> <span class="n">num</span><span class="p">,</span>
    <span class="s1">&#39;2022-01-01&#39;</span> <span class="k">as</span> <span class="n">date</span><span class="p">,</span>
    <span class="n">goods_id</span><span class="p">,</span>
    <span class="n">goods_name</span><span class="p">,</span>
    <span class="n">sell_price</span><span class="p">,</span> <span class="n">buy_price</span><span class="p">,</span> <span class="n">sell_price</span> <span class="o">-</span> <span class="n">buy_price</span> <span class="k">as</span> <span class="n">profit</span>
<span class="kn">from</span> <span class="nn">goods</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="select-adv">
<img alt="_images/select_adv.png" src="_images/select_adv.png" />
<p class="caption"><span class="caption-number">Fig. 5.10 </span><span class="caption-text">열에 상수 및 계산식 작성하기</span><a class="headerlink" href="#select-adv" title="Permalink to this image">¶</a></p>
</div>
<p>category, num, date 열에는 각각 상품, 38, 2022-01-01이라는 상수가 입력된다. 또한 <code class="docutils literal notranslate"><span class="pre">sell_price</span> <span class="pre">-</span> <span class="pre">buy_price</span></code>를 통해 두 열의 차이를 계산할 수 있으며, as 키워드를 통해 해당 열을 profit 으로 출력한다. 만일 별명을 부여하지 않을 경우 해당 열 이름은 계산식인 [sell_price - buy_price]가 그대로 출력된다.</p>
</div>
<div class="section" id="distinct">
<h3><span class="section-number">5.2.2. </span><code class="docutils literal notranslate"><span class="pre">distinct</span></code>: 중복 제거하기<a class="headerlink" href="#distinct" title="Permalink to this headline">¶</a></h3>
<p>중복된 데이터가 있는 경우 중복되는 값을 제거하고 고유한 값만 확인하고 싶을 때는 distinct 키워드를 사용하며, 사용법은 다음과 같다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">distinct</span> <span class="o">&lt;</span><span class="n">열</span> <span class="n">이름</span><span class="o">&gt;</span>
<span class="kn">from</span> <span class="o">&lt;</span><span class="n">테이블명</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<p>상품 분류에 해당하는 goods_classify 열에는 중복된 값들이 존재한다. 만일 상품 분류가 어떤 것이 있는지 고유한 값만을 확인하고 싶을 경우 아래 쿼리를 실행하면 된다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">distinct</span> <span class="n">goods_classify</span>
<span class="kn">from</span> <span class="nn">goods</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="id6">
<img alt="_images/distinct.png" src="_images/distinct.png" />
<p class="caption"><span class="caption-number">Fig. 5.11 </span><span class="caption-text">중복 제거하기</span><a class="headerlink" href="#id6" title="Permalink to this image">¶</a></p>
</div>
<p>상품 분류 중 고유한 값인 의류, 사무용품, 주방용품만이 출력된다.</p>
</div>
<div class="section" id="where">
<h3><span class="section-number">5.2.3. </span><code class="docutils literal notranslate"><span class="pre">where</span></code>: 원하는 행 선택하기<a class="headerlink" href="#where" title="Permalink to this headline">¶</a></h3>
<p>여러 데이터 중 조건에 부합하는 행만 선택할 때는 where 구를 사용하면 된다. 이는 엑셀에서 필터 기능과도 비슷하다. where 구는 from 구 바로 뒤에 사용해야 작동한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>select &lt;열 이름&gt;, …
from &lt;테이블명&gt;
where &lt;조건식&gt;;
</pre></div>
</div>
</div>
</div>
<p>테이블에서 상품 분류(goods_classify)가 의류인 데이터만 선택해보도록 하자.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">goods_name</span><span class="p">,</span> <span class="n">goods_classify</span>
<span class="kn">from</span> <span class="nn">goods</span>
<span class="n">where</span> <span class="n">goods_classify</span> <span class="o">=</span> <span class="s1">&#39;의류&#39;</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="id7">
<img alt="_images/where.png" src="_images/where.png" />
<p class="caption"><span class="caption-number">Fig. 5.12 </span><span class="caption-text">행 선택하기</span><a class="headerlink" href="#id7" title="Permalink to this image">¶</a></p>
</div>
<p>여러 데이터 중 goods_classify가 의류인 데이터 2개(티셔츠, 와이셔츠)만 선택되었다.</p>
</div>
</div>
<div class="section" id="id8">
<h2><span class="section-number">5.3. </span>연산자<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h2>
<p>연산자는 SQL 문에서 연산을 수행하기 위해 사용되는 사전에 예약된 단어 또는 문자로써 일반적으로 where 구 안에서 사용된다. 흔히 사용되는 연산자는 다음과 같다.</p>
<ul class="simple">
<li><p>산술 연산자</p></li>
<li><p>비교 연산자</p></li>
<li><p>논리 연산자</p></li>
</ul>
<div class="section" id="id9">
<h3><span class="section-number">5.3.1. </span>산술 연산자<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>산술 연산자는 더하기, 빼기, 곱하기, 나누기 등 계산을 할 때 사용되는 연산자이다. 만일 판매가에서 구매가를 뺀 이익이 500 이상인 데이터만 선택하려면 다음과 같은 쿼리를 실행한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="o">*</span><span class="p">,</span> <span class="n">sell_price</span> <span class="o">-</span> <span class="n">buy_price</span> <span class="k">as</span> <span class="n">profit</span>
<span class="kn">from</span> <span class="nn">goods</span>
<span class="n">where</span> <span class="n">sell_price</span> <span class="o">-</span> <span class="n">buy_price</span> <span class="o">&gt;=</span> <span class="mi">500</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="ope-cal">
<img alt="_images/ope_cal.png" src="_images/ope_cal.png" />
<p class="caption"><span class="caption-number">Fig. 5.13 </span><span class="caption-text">산술 연산자</span><a class="headerlink" href="#ope-cal" title="Permalink to this image">¶</a></p>
</div>
<p>where 구문 내애 [sell_price - buy_price]를 계산하여 이익이 500 이상인 조건에 만족하는 데이터만을 선택하였다.</p>
</div>
<div class="section" id="id10">
<h3><span class="section-number">5.3.2. </span>비교 연산자<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>비교 연산자는 데이터의 크기를 비교할 때 사용되는 연산자이며, 종류는 다음과 같다.</p>
<table class="colwidths-auto table" id="id49">
<caption><span class="caption-number">Table 5.1 </span><span class="caption-text">비교 연산자 종류</span><a class="headerlink" href="#id49" title="Permalink to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>연산자</p></th>
<th class="head"><p>의미</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>=</p></td>
<td><p>~와 같다</p></td>
</tr>
<tr class="row-odd"><td><p>&lt;&gt;</p></td>
<td><p>~와 같지 않다</p></td>
</tr>
<tr class="row-even"><td><p>&gt;=</p></td>
<td><p>~ 이상</p></td>
</tr>
<tr class="row-odd"><td><p>&gt;</p></td>
<td><p>~ 보다 크다</p></td>
</tr>
<tr class="row-even"><td><p>&lt;=</p></td>
<td><p>~ 이하</p></td>
</tr>
<tr class="row-odd"><td><p>&lt;</p></td>
<td><p>~ 보다 작다</p></td>
</tr>
</tbody>
</table>
<p>sell_price가 1000 이상인 데이터만 선택하는 쿼리는 다음과 같다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">goods_name</span><span class="p">,</span> <span class="n">goods_classify</span><span class="p">,</span> <span class="n">sell_price</span>
<span class="kn">from</span> <span class="nn">goods</span>
<span class="n">where</span> <span class="n">sell_price</span> <span class="o">&gt;=</span> <span class="mi">1000</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="ope-1">
<img alt="_images/ope_1.png" src="_images/ope_1.png" />
<p class="caption"><span class="caption-number">Fig. 5.14 </span><span class="caption-text">비교 연산자 (1)</span><a class="headerlink" href="#ope-1" title="Permalink to this image">¶</a></p>
</div>
<p>숫자 뿐 아니라 날짜에도 비교 연산자를 사용할 수 있다. 등록일(register_date)이 2020년 9월 27일 이전인 데이터만 선택하는 쿼리는 다음과 같다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">goods_name</span><span class="p">,</span> <span class="n">goods_classify</span><span class="p">,</span> <span class="n">register_date</span>
<span class="kn">from</span> <span class="nn">goods</span>
<span class="n">where</span> <span class="n">register_date</span> <span class="o">&lt;</span> <span class="s1">&#39;2020-09-27&#39;</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="ope-2">
<img alt="_images/ope_2.png" src="_images/ope_2.png" />
<p class="caption"><span class="caption-number">Fig. 5.15 </span><span class="caption-text">비교 연산자 (2)</span><a class="headerlink" href="#ope-2" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="id11">
<h3><span class="section-number">5.3.3. </span>논리 연산자<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>where 구 내에 <code class="docutils literal notranslate"><span class="pre">and</span></code> 연산자와 <code class="docutils literal notranslate"><span class="pre">or</span></code> 연산자와 같은 논리 연산자를 사용하면 복수의 검색 조건을 조합할 수 있다. 예를 들어 상품 분류가 주방용품이고 판매가가 3000 이상인 데이터를 조회하는 쿼리는 다음과 같다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">goods_name</span><span class="p">,</span> <span class="n">goods_classify</span><span class="p">,</span> <span class="n">sell_price</span>
<span class="kn">from</span> <span class="nn">goods</span>
<span class="n">where</span> <span class="n">goods_classify</span> <span class="o">=</span> <span class="s1">&#39;주방용품&#39;</span>
<span class="ow">and</span> <span class="n">sell_price</span> <span class="o">&gt;=</span> <span class="mi">3000</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="ope-and">
<img alt="_images/ope_and.png" src="_images/ope_and.png" />
<p class="caption"><span class="caption-number">Fig. 5.16 </span><span class="caption-text">논리 연산자 (and)</span><a class="headerlink" href="#ope-and" title="Permalink to this image">¶</a></p>
</div>
<p>두 조건을 모두 만족하는 데이터가 선택되었다. 만약 상품 분류가 주방용품이거나 판매가가 3000 이상인 경우처럼 여러 조건 중 하나만 만족해도 되는 경우를 검색하고 싶을 경우에는 <code class="docutils literal notranslate"><span class="pre">or</span></code> 연산자를 사용하면 된다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">goods_name</span><span class="p">,</span> <span class="n">goods_classify</span><span class="p">,</span> <span class="n">sell_price</span>
<span class="kn">from</span> <span class="nn">goods</span>
<span class="n">where</span> <span class="n">goods_classify</span> <span class="o">=</span> <span class="s1">&#39;주방용품&#39;</span>
<span class="ow">or</span> <span class="n">sell_price</span> <span class="o">&gt;=</span> <span class="mi">3000</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="ope-or">
<img alt="_images/ope_or.png" src="_images/ope_or.png" />
<p class="caption"><span class="caption-number">Fig. 5.17 </span><span class="caption-text">논리 연산자 (or)</span><a class="headerlink" href="#ope-or" title="Permalink to this image">¶</a></p>
</div>
</div>
</div>
<div class="section" id="id12">
<h2><span class="section-number">5.4. </span>집약 함수<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h2>
<p>집약 함수란 여러 개의 레코드를 하나로 집약시키는 기능으로써, 대표적으로 사용되는 집약 함수는 다음과 같다.</p>
<table class="colwidths-auto table" id="id50">
<caption><span class="caption-number">Table 5.2 </span><span class="caption-text">집약 함수의 종류</span><a class="headerlink" href="#id50" title="Permalink to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>함수명</p></th>
<th class="head"><p>의미</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>count</p></td>
<td><p>행 숫자를 계산</p></td>
</tr>
<tr class="row-odd"><td><p>sum</p></td>
<td><p>합계를 계산</p></td>
</tr>
<tr class="row-even"><td><p>avg</p></td>
<td><p>평균을 구함</p></td>
</tr>
<tr class="row-odd"><td><p>max</p></td>
<td><p>최댓값을 구함</p></td>
</tr>
<tr class="row-even"><td><p>min</p></td>
<td><p>최솟값을 구함</p></td>
</tr>
</tbody>
</table>
<div class="section" id="count">
<h3><span class="section-number">5.4.1. </span><code class="docutils literal notranslate"><span class="pre">count</span></code>: 행 숫자를 계산<a class="headerlink" href="#count" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">count</span></code> 함수는 행의 숫자를 계산한다. goods 테이블에 몇 개의 행이 있는 확인하는 쿼리는 다음과 같다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">goods</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="id13">
<img alt="_images/count.png" src="_images/count.png" />
<p class="caption"><span class="caption-number">Fig. 5.18 </span><span class="caption-text">count 함수</span><a class="headerlink" href="#id13" title="Permalink to this image">¶</a></p>
</div>
<p>별표(*)는 모든 열을 의미하며 총 8개의 행이 있다는 것이 확인되었다. 그러나 이는 null이 포함된 행의 수이다. 만일 null을 제외한 행의 수를 계산하고자 할 때는 인수에 특정 열을 지정한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">count</span><span class="p">(</span><span class="n">buy_price</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">goods</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="count-2">
<img alt="_images/count_2.png" src="_images/count_2.png" />
<p class="caption"><span class="caption-number">Fig. 5.19 </span><span class="caption-text">count 함수 (2)</span><a class="headerlink" href="#count-2" title="Permalink to this image">¶</a></p>
</div>
<p>‘buy_price’ 열의 8개 데이터 중에는 총 2개의 null값이 있다. 따라서 count 함수를 실행하면 null을 제외한 6개의 행이 있음이 확인된다. 즉 count(*)는 null을 포함한 행의 갯수를, count(열 이름)은 null을 제외한 행 수를 계산한다.</p>
</div>
<div class="section" id="sum">
<h3><span class="section-number">5.4.2. </span><code class="docutils literal notranslate"><span class="pre">sum</span></code>: 합계를 계산<a class="headerlink" href="#sum" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">sum</span></code> 함수는 특정 열의 합계를 계산하며, null 값은 무시하고 계산이 된다. sell_price와 buy_price 열의 합계를 구하는 쿼리는 다음과 같다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="nb">sum</span><span class="p">(</span><span class="n">sell_price</span><span class="p">),</span> <span class="nb">sum</span><span class="p">(</span><span class="n">buy_price</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">goods</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="id14">
<img alt="_images/sum.png" src="_images/sum.png" />
<p class="caption"><span class="caption-number">Fig. 5.20 </span><span class="caption-text">sum 함수</span><a class="headerlink" href="#id14" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="avg">
<h3><span class="section-number">5.4.3. </span><code class="docutils literal notranslate"><span class="pre">avg</span></code>: 산술평균을 계산<a class="headerlink" href="#avg" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">avg</span></code> 함수는 산술평균을 구하며, 사용법은 <code class="docutils literal notranslate"><span class="pre">sum</span></code>과 동일하다. sell_price 열의 평균을 구하는 쿼리는 다음과 같다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">avg</span><span class="p">(</span><span class="n">sell_price</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">goods</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="id15">
<img alt="_images/avg.png" src="_images/avg.png" />
<p class="caption"><span class="caption-number">Fig. 5.21 </span><span class="caption-text">avg 함수</span><a class="headerlink" href="#id15" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="id16">
<h3><span class="section-number">5.4.4. </span>중복값 제외 후 집약함수 사용하기<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h3>
<p>만일 상품 분류가 몇 개가 있는지 확인하고 싶을 때는 어떻게 하면 될까? <code class="docutils literal notranslate"><span class="pre">count</span></code> 함수의 인자에 <code class="docutils literal notranslate"><span class="pre">distict</span></code> 키워드를 사용해 중복되지 않은 데이터의 갯수를 계산할 수 있다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">count</span><span class="p">(</span><span class="n">distinct</span> <span class="n">goods_classify</span><span class="p">)</span> 
<span class="kn">from</span> <span class="nn">goods</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="count-distinct">
<img alt="_images/count_distinct.png" src="_images/count_distinct.png" />
<p class="caption"><span class="caption-number">Fig. 5.22 </span><span class="caption-text">중복값 제외 후 집약함수 사용하기</span><a class="headerlink" href="#count-distinct" title="Permalink to this image">¶</a></p>
</div>
<p>goods_classify 에는 의류, 사무용품, 주방용품 3개가 있으므로 이에 해당하는 값이 계산되었다. 이는 count 뿐만 아니라 <code class="docutils literal notranslate"><span class="pre">sum(distinct</span> <span class="pre">열</span> <span class="pre">이름)</span></code>과 같이 다른 집약함수에도 동일하게 적용이 가능하다.</p>
</div>
</div>
<div class="section" id="id17">
<h2><span class="section-number">5.5. </span>그룹화와 정렬<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h2>
<p>데이터를 특정 기준으로 그룹을 나누어 값을 계산해야 하는 경우가 많다. 예를 들어 상품 분류 별 혹은 등록일 별 그룹을 나누어 손익을 계산한다고 생각해 보자. 이러한 경우 SQL에서는 <code class="docutils literal notranslate"><span class="pre">group</span> <span class="pre">by</span></code> 구를 사용하여 데이터를 그룹화할 수 있다. 또한 검색 결과를 특정 기준으로 정렬할 필요가 있을 경우 <code class="docutils literal notranslate"><span class="pre">order</span> <span class="pre">by</span></code> 구를 사용하면 된다.</p>
<div class="section" id="id18">
<h3><span class="section-number">5.5.1. </span>그룹 나누기<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h3>
<div class="figure align-default" id="group">
<img alt="_images/group1.png" src="_images/group1.png" />
<p class="caption"><span class="caption-number">Fig. 5.23 </span><span class="caption-text">데이터의 그룹 나누기</span><a class="headerlink" href="#group" title="Permalink to this image">¶</a></p>
</div>
<p><a class="reference internal" href="#group"><span class="std std-numref">Fig. 5.23</span></a>의 경우 category 별로 그룹을 나누어 평균을 계산하기 위해서는 데이터를 Blue, Green, Red 별로 그룹을 나누어 평균을 계산해야 한다. 이러한 그룹화 작업을 수행하는 구가 <code class="docutils literal notranslate"><span class="pre">group</span> <span class="pre">by</span></code>이며, 사용법은 아래와 같이 그룹을 나누고자 하는 열을 입력하면 된다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>select &lt;열 이름 1&gt;, &lt;열 이름 2&gt;, …..
from &lt;테이블명&gt;
group by &lt;열 이름 1&gt;, &lt;열 이름 2&gt;, ….
</pre></div>
</div>
</div>
</div>
<p>상품 분류 별 데이터의 수를 계산하기 위한 쿼리는 다음과 같다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">goods_classify</span><span class="p">,</span> <span class="n">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">goods</span>
<span class="n">group</span> <span class="n">by</span> <span class="n">goods_classify</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="group-count">
<img alt="_images/group_count.png" src="_images/group_count.png" />
<p class="caption"><span class="caption-number">Fig. 5.24 </span><span class="caption-text">그룹 별 계산하기</span><a class="headerlink" href="#group-count" title="Permalink to this image">¶</a></p>
</div>
<p>goods_classify 별로 그룹을 나눈 후 <code class="docutils literal notranslate"><span class="pre">count(*)</span></code>를 통해 각 그룹 별 행 갯수를 구할 수 있다. <code class="docutils literal notranslate"><span class="pre">group</span> <span class="pre">by</span></code> 구는 반드시 <code class="docutils literal notranslate"><span class="pre">from</span></code> 구 뒤에 두어야 한다. 이번에는 buy_price 별 행 갯수를 구해보도록 하자.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">buy_price</span><span class="p">,</span> <span class="n">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">goods</span>
<span class="n">group</span> <span class="n">by</span> <span class="n">buy_price</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="group-null">
<img alt="_images/group_null.png" src="_images/group_null.png" />
<p class="caption"><span class="caption-number">Fig. 5.25 </span><span class="caption-text">그룹 별 계산하기(null 포함)</span><a class="headerlink" href="#group-null" title="Permalink to this image">¶</a></p>
</div>
<p>buy_price 열에는 null 데이터도 포함되어 있으며, 이 역시 별도의 그룹으로 분류됨을 알 수 있다. 만일 <code class="docutils literal notranslate"><span class="pre">where</span></code> 구를 통해 조건에 맞는 데이터를 선택한 후 <code class="docutils literal notranslate"><span class="pre">group</span> <span class="pre">by</span></code> 구를 통해 그룹을 나눌때는 어떻게 해야 할까? 이 경우 <code class="docutils literal notranslate"><span class="pre">where</span></code> 구 뒤에 <code class="docutils literal notranslate"><span class="pre">group</span> <span class="pre">by</span></code> 구를 작성해야 한다. 상품 분류가 의류인 것 중 buy_price 별 데이터의 수를 구하는 쿼리는 다음과 같다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">buy_price</span><span class="p">,</span> <span class="n">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">goods</span>
<span class="n">where</span> <span class="n">goods_classify</span> <span class="o">=</span> <span class="s1">&#39;의류&#39;</span>
<span class="n">group</span> <span class="n">by</span> <span class="n">buy_price</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="group-where">
<img alt="_images/group_where.png" src="_images/group_where.png" />
<p class="caption"><span class="caption-number">Fig. 5.26 </span><span class="caption-text">조건 검색 이후 그룹 별 계산하기</span><a class="headerlink" href="#group-where" title="Permalink to this image">¶</a></p>
</div>
<p>만일 <code class="docutils literal notranslate"><span class="pre">group</span> <span class="pre">by</span></code>를 통해 나온 결과에 조건을 지정하려면 어떻게 해야 할까? 이 경우 <code class="docutils literal notranslate"><span class="pre">where</span></code>이 아닌 <code class="docutils literal notranslate"><span class="pre">having</span></code> 구를 사용해야 한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>select &lt;열 이름 1&gt;, &lt;열 이름 2&gt;, …
from &lt;테이블 명&gt;
group by &lt;열 이름 1&gt;, &lt;열 이름 2&gt;, …
having &lt;그룹값에 대한 조건&gt;
</pre></div>
</div>
</div>
</div>
<p>예를 들어 상품 분류별로 판매가의 평균을 구한 후, 이 값이 2500 이상인 데이터를 구하는 쿼리는 다음과 같다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">goods_classify</span><span class="p">,</span> <span class="n">avg</span><span class="p">(</span><span class="n">sell_price</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">goods</span>
<span class="n">group</span> <span class="n">by</span> <span class="n">goods_classify</span>
<span class="n">having</span> <span class="n">avg</span><span class="p">(</span><span class="n">sell_price</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2500</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="group-having">
<img alt="_images/group_having.png" src="_images/group_having.png" />
<p class="caption"><span class="caption-number">Fig. 5.27 </span><span class="caption-text">그룹 별 계산 후 조건 검색</span><a class="headerlink" href="#group-having" title="Permalink to this image">¶</a></p>
</div>
<p>요약하자면 <code class="docutils literal notranslate"><span class="pre">where</span></code>는 <code class="docutils literal notranslate"><span class="pre">group</span> <span class="pre">by</span></code> 계산 이전, <code class="docutils literal notranslate"><span class="pre">having</span></code>은 <code class="docutils literal notranslate"><span class="pre">group</span> <span class="pre">by</span></code> 계산 이후 적용된다.</p>
</div>
<div class="section" id="id19">
<h3><span class="section-number">5.5.2. </span>검색 결과 정렬하기<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h3>
<p>SQL에서는 결과가 무작위로 정렬되므로 쿼리를 실행할 때 마다 결과가 변한다. 오름차순이나 내림차순으로 결과를 정렬하고자 할 경우에는 <code class="docutils literal notranslate"><span class="pre">order</span> <span class="pre">by</span></code> 구를 사용한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>select &lt;열 이름 1&gt;, &lt;열 이름 2&gt;, …
from &lt;테이블명&gt;
order by &lt;재정렬 기준 열 1&gt;, &lt;재정렬 기준 열 2&gt;, ...
</pre></div>
</div>
</div>
</div>
<p>예를 들어 sell_price가 싼 순서, 즉 오름차순으로 정렬할 경우 쿼리는 다음과 같다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">goods</span>
<span class="n">order</span> <span class="n">by</span> <span class="n">sell_price</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="order">
<img alt="_images/order.png" src="_images/order.png" />
<p class="caption"><span class="caption-number">Fig. 5.28 </span><span class="caption-text">데이터 정렬하기</span><a class="headerlink" href="#order" title="Permalink to this image">¶</a></p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">order</span> <span class="pre">by</span></code> 구는 기본적으로 오름차순으로 데이터를 정렬한다. 만일 내림차순으로 정렬하고자 할 경우 재정렬 기준 뒤에 desc 키워드를 사용한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">goods</span>
<span class="n">order</span> <span class="n">by</span> <span class="n">sell_price</span> <span class="n">desc</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="order-desc">
<img alt="_images/order_desc.png" src="_images/order_desc.png" />
<p class="caption"><span class="caption-number">Fig. 5.29 </span><span class="caption-text">데이터 정렬하기 (내림차순)</span><a class="headerlink" href="#order-desc" title="Permalink to this image">¶</a></p>
</div>
</div>
</div>
<div class="section" id="id20">
<h2><span class="section-number">5.6. </span>뷰와 서브쿼리<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h2>
<p>기초구문 만으로는 복잡한 형태의 데이터분석을 하는게 한계가 있으며, 뷰와 서브쿼리를 이용하면 이러한 작업을 쉽게 할 수 있다.</p>
<div class="section" id="id21">
<h3><span class="section-number">5.6.1. </span>뷰 만들기<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h3>
<p>뷰는 기본적으로 테이블과 거의 동일하다. 그러나 테이블과의 차이는 실제 데이터를 저장하고 있지 않다는 점이다. 뷰는 데이터를 저장하지 않고 있으며, 뷰에서 데이터를 꺼내려고 할 때 내부적으로 쿼리를 실행하여 일시적인 가상 테이블을 만든다. 즉, 데이터가 아닌 쿼리를 저장하고 있다고 보면 된다. 이러한 뷰가 가진 장점은 다음과 같다.</p>
<ol class="simple">
<li><p>데이터를 저장하지 않기 때문에 기억 장치 용량을 절약할 수 있다.</p></li>
<li><p>자주 사용하는 쿼리를 매번 작성하지 않고 뷰로 저장하면 반복해서 사용이 가능한다. 뷰는 원래의 테이블과 연동되므로, 데이터가 최신 상태로 갱신되면 뷰의 결과 역시 자동으로 최신 상태를 보여준다.</p></li>
</ol>
<p>뷰는 <code class="docutils literal notranslate"><span class="pre">create</span> <span class="pre">view</span></code> 문을 사용해 만들 수 있다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">create</span> <span class="n">view</span> <span class="n">뷰</span> <span class="n">이름</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">뷰의</span> <span class="n">열</span> <span class="n">이름</span> <span class="mi">1</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">뷰의</span> <span class="n">열</span> <span class="n">이름</span> <span class="mi">2</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="k">as</span>
<span class="o">&lt;</span><span class="n">쿼리</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<p>만일 <strong>상품 분류 별 행 갯수</strong>를 매일 조회해야 한다면, 매번 쿼리를 실행하는 것 보다 뷰를 만들어 이를 확인하는 것이 훨씬 효율적이다. 아래의 쿼리를 통해 해당 뷰를 만들 수 있다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">create</span> <span class="n">view</span> <span class="n">GoodSum</span> <span class="p">(</span><span class="n">goods_classify</span><span class="p">,</span> <span class="n">cnt_goods</span><span class="p">)</span>
<span class="k">as</span>
<span class="n">select</span> <span class="n">goods_classify</span><span class="p">,</span> <span class="n">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">goods</span>
<span class="n">group</span> <span class="n">by</span> <span class="n">goods_classify</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="view">
<img alt="_images/view.png" src="_images/view.png" />
<p class="caption"><span class="caption-number">Fig. 5.30 </span><span class="caption-text">뷰 생성하기</span><a class="headerlink" href="#view" title="Permalink to this image">¶</a></p>
</div>
<p>위 쿼리를 실행한 후 SCHEMAS 부분에서 새로고침을 눌러보면 Views 하부에 goodsum 이라는 뷰가 생긴것이 확인된다. 뷰의 데이터를 확인하는 방법은 테이블의 데이터를 확인하는 방법과 동일하다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">GoodSum</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="view-2">
<img alt="_images/view_2.png" src="_images/view_2.png" />
<p class="caption"><span class="caption-number">Fig. 5.31 </span><span class="caption-text">뷰 확인하기</span><a class="headerlink" href="#view-2" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="id22">
<h3><span class="section-number">5.6.2. </span>뷰 삭제하기<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h3>
<p>뷰를 삭제하려면 <code class="docutils literal notranslate"><span class="pre">drop</span> <span class="pre">view</span> <span class="pre">뷰명</span></code> 문을 사용한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">drop</span> <span class="n">view</span> <span class="n">GoodSum</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<p>혹은 SCHEMAS 영역에서 삭제하고자 하는 뷰를 선택한 후 마우스 우클릭을 눌러 [Drop View]를 클릭해도 해당 뷰가 삭제된다.</p>
<div class="figure align-default" id="view-delete">
<img alt="_images/view_delete.png" src="_images/view_delete.png" />
<p class="caption"><span class="caption-number">Fig. 5.32 </span><span class="caption-text">뷰 삭제하기</span><a class="headerlink" href="#view-delete" title="Permalink to this image">¶</a></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>뷰 위에 뷰를 겹쳐 사용하면 성능저하가 일어나므로, 겹쳐서 사용하지 않는 것이 좋다.</p>
</div>
</div>
<div class="section" id="id23">
<h3><span class="section-number">5.6.3. </span>서브쿼리<a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h3>
<p>서브쿼리란 쿼리 내의 쿼리이며, 일회용 뷰를 의미한다. 즉, 뷰를 정의하는 구문을 그대로 다른 구 안에 삽입하는 것이다. 먼저 뷰를 만든 후 이를 확인하는 쿼리는 다음과 같다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">create</span> <span class="n">view</span> <span class="n">GoodSum</span> <span class="p">(</span><span class="n">goods_classify</span><span class="p">,</span> <span class="n">cnt_goods</span><span class="p">)</span>
<span class="k">as</span>
<span class="n">select</span> <span class="n">goods_classify</span><span class="p">,</span> <span class="n">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">goods</span>
<span class="n">group</span> <span class="n">by</span> <span class="n">goods_classify</span><span class="p">;</span>

<span class="n">select</span> <span class="o">*</span> <span class="kn">from</span> <span class="nn">GoodSum</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<p>이와 동일한 결과가 나오게 하는 서브쿼리는 다음과 같다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">goods_classify</span><span class="p">,</span> <span class="n">cnt_goods</span>
<span class="kn">from</span> <span class="p">(</span>
 <span class="n">select</span> <span class="n">goods_classify</span><span class="p">,</span> <span class="n">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">as</span> <span class="n">cnt_goods</span>
 <span class="kn">from</span> <span class="nn">goods</span>
 <span class="n">group</span> <span class="n">by</span> <span class="n">goods_classify</span>
<span class="p">)</span> <span class="k">as</span> <span class="n">GoodsSum</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<p>from 구 뒤의 괄호안에 해당하는 부분은 뷰를 만들 때 사용하던 코드와 동일하다. 즉, ① from 구 안의 select 문(서브쿼리)가 실행되고, ② 이 결과를 바탕으로 바깥쪽 select 문이 실행된다.</p>
</div>
<div class="section" id="id24">
<h3><span class="section-number">5.6.4. </span>스칼라 서브쿼리<a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h3>
<p>스칼라 서브쿼리란 단이 값이 반환되는 서브쿼리다. 이를 통해 =, &lt;, &gt; 등 비교 연산자의 입력값으로 사용할 수 있다. 예를 들어 판매단가가 전체 평균 판매단가보다 높은 상품만을 검색하려면 어떻게 해야할까? 먼저 평균 단가를 계산해야 한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">avg</span><span class="p">(</span><span class="n">sell_price</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">goods</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="sub-scala">
<img alt="_images/sub_scala.png" src="_images/sub_scala.png" />
<p class="caption"><span class="caption-number">Fig. 5.33 </span><span class="caption-text">평균 단가 계산하기</span><a class="headerlink" href="#sub-scala" title="Permalink to this image">¶</a></p>
</div>
<p>해당 쿼리를 서브쿼리에 넣어 원하는 값을 찾을 수 있다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">goods</span>
<span class="n">where</span> <span class="n">sell_price</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">select</span> <span class="n">avg</span><span class="p">(</span><span class="n">sell_price</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">goods</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="sub-scala-2">
<img alt="_images/sub_scala_2.png" src="_images/sub_scala_2.png" />
<p class="caption"><span class="caption-number">Fig. 5.34 </span><span class="caption-text">스칼라 서브쿼리를 이용한 조건 검색</span><a class="headerlink" href="#sub-scala-2" title="Permalink to this image">¶</a></p>
</div>
<p>스칼라 서브쿼리는 where 구 뿐만 아니라 select, group by, having, order by 구 등 거의 모든 곳에 쓸 수 있다. 평균 판매가격을 새로운 열로 만드는 쿼리는 다음과 같다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">goods_id</span><span class="p">,</span> <span class="n">goods_name</span><span class="p">,</span> <span class="n">sell_price</span><span class="p">,</span>
	<span class="p">(</span><span class="n">select</span> <span class="n">avg</span><span class="p">(</span><span class="n">sell_price</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">goods</span><span class="p">)</span> <span class="k">as</span> <span class="n">avg_price</span>
<span class="kn">from</span> <span class="nn">goods</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="sub-select">
<img alt="_images/sub_select.png" src="_images/sub_select.png" />
<p class="caption"><span class="caption-number">Fig. 5.35 </span><span class="caption-text">select 내 서브쿼리</span><a class="headerlink" href="#sub-select" title="Permalink to this image">¶</a></p>
</div>
<p>select 구문 내에 <code class="docutils literal notranslate"><span class="pre">select</span> <span class="pre">avg(sell_price)</span> <span class="pre">from</span> <span class="pre">goods</span></code> 쿼리를 입력하여 평균 판매가격을 계산한 후 이를 avg_price 라는 열 이름으로 출력한다.</p>
<p>이번에는 좀 더 복잡한 조건에 해당하는 데이터를 찾아보도록 하자. 상품 분류 별 평균 판매가격이 전체 데이터의 평균 판매가격 이상인 데이터만 출력하는 쿼리는 다음과 같다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">goods_classify</span><span class="p">,</span> <span class="n">avg</span><span class="p">(</span><span class="n">sell_price</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">goods</span>
<span class="n">group</span> <span class="n">by</span> <span class="n">goods_classify</span>
<span class="n">having</span> <span class="n">avg</span><span class="p">(</span><span class="n">sell_price</span><span class="p">)</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">select</span> <span class="n">avg</span><span class="p">(</span><span class="n">sell_price</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">goods</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="sub-having">
<img alt="_images/sub_having.png" src="_images/sub_having.png" />
<p class="caption"><span class="caption-number">Fig. 5.36 </span><span class="caption-text">having 내 서브쿼리</span><a class="headerlink" href="#sub-having" title="Permalink to this image">¶</a></p>
</div>
<p>먼저 <code class="docutils literal notranslate"><span class="pre">group</span> <span class="pre">by</span></code> 구문을 이용해 상품 분류 별 평균 판매가격을 계산한다. 그 후 having 구문 내에 전체 평균 판매가격을 계산하는 서브쿼리인 <code class="docutils literal notranslate"><span class="pre">select</span> <span class="pre">avg(sell_price)</span> <span class="pre">from</span> <span class="pre">goods</span></code> 를 입력하여 2097.5 라는 값을 계산하고, 그룹별 평균 판매가격이 이 값보다 큰 데이터만을 선택하게 된다.</p>
</div>
</div>
<div class="section" id="case">
<h2><span class="section-number">5.7. </span>함수, 술어와 case 식<a class="headerlink" href="#case" title="Permalink to this headline">¶</a></h2>
<p>SQL에서도 함수를 이용해 다양한 연산을 할 수 있으며, 다음과 같은 함수가 존재한다. 본 책에서는 수치 계산을 위한 ‘산술 함수’, 문자열 처리를 위한 ‘문자열 함수’, 날짜 처리를 위한 ‘날짜 함수’에 대해 대해 알아보겠다. 또한 함수의 변형 형태인 술어는 반환 값이 진리값(TRUE/FALSE/UNKNOWN)인 함수라 볼 수 있다. 마지막으로 <code class="docutils literal notranslate"><span class="pre">case</span></code> 식 역시 함수의 일종으로써, SQL 내에서의 <code class="docutils literal notranslate"><span class="pre">if</span></code> 문 이라고도 볼 수 있다.  <code class="docutils literal notranslate"><span class="pre">case</span></code>는 조건에 해당하는 목록을 평가하고 가능한 여러 결과 식 중 하나를 반환한다.</p>
<div class="section" id="id25">
<h3><span class="section-number">5.7.1. </span>산술 함수<a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h3>
<p>산술 함수는 숫자형 데이터의 절대값, 올림, 내림, 반올림 등을 계산할 수 있게 해준다. 먼저 m, n, p 3개 열로 구성된 테이블(SampleMath)을 만들어 주도록 한다(<a class="reference internal" href="#samplemath"><span class="std std-numref">Fig. 5.37</span></a>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">create</span> <span class="n">table</span> <span class="n">SampleMath</span>
<span class="p">(</span><span class="n">m</span>  <span class="n">numeric</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span>
 <span class="n">n</span>  <span class="n">integer</span><span class="p">,</span>
 <span class="n">p</span>  <span class="n">integer</span><span class="p">);</span>

<span class="n">insert</span> <span class="n">into</span> <span class="n">SampleMath</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NULL</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">SampleMath</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NULL</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">SampleMath</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="n">NULL</span><span class="p">,</span> <span class="n">NULL</span><span class="p">,</span> <span class="n">NULL</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">SampleMath</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="n">NULL</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">SampleMath</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="n">NULL</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">SampleMath</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="n">NULL</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">NULL</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">SampleMath</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">NULL</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">SampleMath</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="mf">2.27</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">NULL</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">SampleMath</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="mf">5.555</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">NULL</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">SampleMath</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="n">NULL</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">NULL</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">SampleMath</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="mf">8.76</span><span class="p">,</span> <span class="n">NULL</span><span class="p">,</span> <span class="n">NULL</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="samplemath">
<img alt="_images/samplemath.png" src="_images/samplemath.png" />
<p class="caption"><span class="caption-number">Fig. 5.37 </span><span class="caption-text">SampleMath 테이블</span><a class="headerlink" href="#samplemath" title="Permalink to this image">¶</a></p>
</div>
<div class="section" id="abs">
<h4><span class="section-number">5.7.1.1. </span><code class="docutils literal notranslate"><span class="pre">abs</span></code>: 절대값 계산하기<a class="headerlink" href="#abs" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">abs</span></code> 함수는 해당 열에 있는 값들의 절대값을 구해준다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">m</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">as</span> <span class="n">abs_m</span>
<span class="kn">from</span> <span class="nn">SampleMath</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="id26">
<img alt="_images/abs.png" src="_images/abs.png" />
<p class="caption"><span class="caption-number">Fig. 5.38 </span><span class="caption-text">abs 함수</span><a class="headerlink" href="#id26" title="Permalink to this image">¶</a></p>
</div>
<p>abs_m은 m열의 절대값을 계산한 것이며, 두번째 행을 보면 -180의 절대값에 해당하는 180이 계산되었다.</p>
</div>
<div class="section" id="mod">
<h4><span class="section-number">5.7.1.2. </span><code class="docutils literal notranslate"><span class="pre">mod</span></code>: 나눗셈의 나머지 구하기<a class="headerlink" href="#mod" title="Permalink to this headline">¶</a></h4>
<p>7 나누기 3의 몫은 2이며 나머지는 1이다. <code class="docutils literal notranslate"><span class="pre">mod</span></code> 함수는 이 나머지에 해당하는 값을 구해준다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">mod</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="k">as</span> <span class="n">mod_col</span>
<span class="kn">from</span> <span class="nn">SampleMath</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="id27">
<img alt="_images/mod.png" src="_images/mod.png" />
<p class="caption"><span class="caption-number">Fig. 5.39 </span><span class="caption-text">mod 함수</span><a class="headerlink" href="#id27" title="Permalink to this image">¶</a></p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">mod(n,</span> <span class="pre">p)</span></code>를 통해 n/p의 나머지를 구한다. 즉 7/3의 나머지인 1, 5/2의 나머지인 1이 계산되며, null은 계산이 불가한 데이터이므로 결과 역시 null로 나온다.</p>
</div>
</div>
<div class="section" id="round">
<h3><span class="section-number">5.7.2. </span><code class="docutils literal notranslate"><span class="pre">round</span></code>: 반올림 하기<a class="headerlink" href="#round" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">round</span></code> 함수를 통해 반올림을 할 수 있으며, 몇 째자리에서 반올림을 할지 정할 수 있다. <code class="docutils literal notranslate"><span class="pre">round(m,</span> <span class="pre">2)</span></code>의 경우 할 경우 m열의 데이터를 소수 둘째자리까지 반올림한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="k">as</span> <span class="n">round_col</span>
<span class="kn">from</span> <span class="nn">SampleMath</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="id28">
<img alt="_images/round.png" src="_images/round.png" />
<p class="caption"><span class="caption-number">Fig. 5.40 </span><span class="caption-text">round 함수</span><a class="headerlink" href="#id28" title="Permalink to this image">¶</a></p>
</div>
<p>위의 쿼리는 m 열을 n 자리까지 반올림한다. n이 0인 경우 소수 0번째 자리, 즉 정수부분까지 반올림을 한다. n이 1인 경우에는 소수 첫째자리까지 반올림을 하기 위해 소수 둘째자리에서 반올림을 한다. <code class="docutils literal notranslate"><span class="pre">round</span></code>와 비슷한 함수로 올림에는 <code class="docutils literal notranslate"><span class="pre">ceil</span></code>, 내림에는 <code class="docutils literal notranslate"><span class="pre">floor</span></code> 함수가 있으므로 상황에 맞게 사용하면 된다.</p>
</div>
<div class="section" id="id29">
<h3><span class="section-number">5.7.3. </span>문자열 함수<a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h3>
<p>문자열 함수는 문자 데이터를 처리할 때 사용되는 함수들이다. 먼저 아래의 샘플 테이블(SampleStr)을 만들도록 하자.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">create</span> <span class="n">table</span> <span class="n">SampleStr</span>
<span class="p">(</span><span class="n">str1</span>  <span class="n">varchar</span><span class="p">(</span><span class="mi">40</span><span class="p">),</span>
 <span class="n">str2</span>  <span class="n">varchar</span><span class="p">(</span><span class="mi">40</span><span class="p">),</span>
 <span class="n">str3</span>  <span class="n">varchar</span><span class="p">(</span><span class="mi">40</span><span class="p">));</span>

<span class="n">insert</span> <span class="n">into</span> <span class="n">SampleStr</span> <span class="p">(</span><span class="n">str1</span><span class="p">,</span> <span class="n">str2</span><span class="p">,</span> <span class="n">str3</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;가나다&#39;</span><span class="p">,</span> <span class="s1">&#39;라마&#39;</span><span class="p">,</span> <span class="n">NULL</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">SampleStr</span> <span class="p">(</span><span class="n">str1</span><span class="p">,</span> <span class="n">str2</span><span class="p">,</span> <span class="n">str3</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">,</span> <span class="s1">&#39;def&#39;</span><span class="p">,</span> <span class="n">NULL</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">SampleStr</span> <span class="p">(</span><span class="n">str1</span><span class="p">,</span> <span class="n">str2</span><span class="p">,</span> <span class="n">str3</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;김&#39;</span><span class="p">,</span> <span class="s1">&#39;철수&#39;</span><span class="p">,</span> <span class="s1">&#39;입니다&#39;</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">SampleStr</span> <span class="p">(</span><span class="n">str1</span><span class="p">,</span> <span class="n">str2</span><span class="p">,</span> <span class="n">str3</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;aaa&#39;</span><span class="p">,</span> <span class="n">NULL</span><span class="p">,</span> <span class="n">NULL</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">SampleStr</span> <span class="p">(</span><span class="n">str1</span><span class="p">,</span> <span class="n">str2</span><span class="p">,</span> <span class="n">str3</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="n">NULL</span><span class="p">,</span> <span class="s1">&#39;가가가&#39;</span><span class="p">,</span> <span class="n">NULL</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">SampleStr</span> <span class="p">(</span><span class="n">str1</span><span class="p">,</span> <span class="n">str2</span><span class="p">,</span> <span class="n">str3</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;@!#$%&#39;</span><span class="p">,</span> <span class="n">NULL</span><span class="p">,</span>	<span class="n">NULL</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">SampleStr</span> <span class="p">(</span><span class="n">str1</span><span class="p">,</span> <span class="n">str2</span><span class="p">,</span> <span class="n">str3</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;ABC&#39;</span><span class="p">,</span>	<span class="n">NULL</span><span class="p">,</span> <span class="n">NULL</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">SampleStr</span> <span class="p">(</span><span class="n">str1</span><span class="p">,</span> <span class="n">str2</span><span class="p">,</span> <span class="n">str3</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;aBC&#39;</span><span class="p">,</span>	<span class="n">NULL</span><span class="p">,</span> <span class="n">NULL</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">SampleStr</span> <span class="p">(</span><span class="n">str1</span><span class="p">,</span> <span class="n">str2</span><span class="p">,</span> <span class="n">str3</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;abc철수&#39;</span><span class="p">,</span> <span class="s1">&#39;abc&#39;</span><span class="p">,</span> <span class="s1">&#39;ABC&#39;</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">SampleStr</span> <span class="p">(</span><span class="n">str1</span><span class="p">,</span> <span class="n">str2</span><span class="p">,</span> <span class="n">str3</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;abcdefabc&#39;</span><span class="p">,</span><span class="s1">&#39;abc&#39;</span><span class="p">,</span> <span class="s1">&#39;ABC&#39;</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">SampleStr</span> <span class="p">(</span><span class="n">str1</span><span class="p">,</span> <span class="n">str2</span><span class="p">,</span> <span class="n">str3</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;아이우&#39;</span><span class="p">,</span> <span class="s1">&#39;이&#39;</span><span class="p">,</span><span class="s1">&#39;우&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="samplestr">
<img alt="_images/samplestr.png" src="_images/samplestr.png" />
<p class="caption"><span class="caption-number">Fig. 5.41 </span><span class="caption-text">SampleStr 테이블</span><a class="headerlink" href="#samplestr" title="Permalink to this image">¶</a></p>
</div>
<div class="section" id="concat">
<h4><span class="section-number">5.7.3.1. </span><code class="docutils literal notranslate"><span class="pre">concat</span></code>: 문자열 연결<a class="headerlink" href="#concat" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">concat</span></code> 함수는 여러 열의 문자열을 연결하는데 사용됩니다. (타 RDMS에서는 ||로 문자를 합치기도 한다.) 먼저 str1과 str2 열의 문자를 합쳐보도록 하자.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">str1</span><span class="p">,</span> <span class="n">str2</span><span class="p">,</span> <span class="n">concat</span><span class="p">(</span><span class="n">str1</span><span class="p">,</span> <span class="n">str2</span><span class="p">)</span> <span class="k">as</span> <span class="n">str_concat</span>
<span class="kn">from</span> <span class="nn">SampleStr</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="id30">
<img alt="_images/concat.png" src="_images/concat.png" />
<p class="caption"><span class="caption-number">Fig. 5.42 </span><span class="caption-text">concat 함수</span><a class="headerlink" href="#id30" title="Permalink to this image">¶</a></p>
</div>
<p>두 열의 문자가 하나로 합쳐지며, null이 포함된 경우는 결과 역시 null이 반환된다.</p>
</div>
<div class="section" id="lower">
<h4><span class="section-number">5.7.3.2. </span><code class="docutils literal notranslate"><span class="pre">lower</span></code>: 소문자로 변환<a class="headerlink" href="#lower" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">lower</span></code> 함수는 모든 알파벳을 소문자로 변환한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">str1</span><span class="p">,</span> <span class="n">lower</span><span class="p">(</span><span class="n">str1</span><span class="p">)</span> <span class="k">as</span> <span class="n">low_str</span>
<span class="kn">from</span> <span class="nn">SampleStr</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="id31">
<img alt="_images/lower.png" src="_images/lower.png" />
<p class="caption"><span class="caption-number">Fig. 5.43 </span><span class="caption-text">lower 함수</span><a class="headerlink" href="#id31" title="Permalink to this image">¶</a></p>
</div>
<p>ABC가 abc로 변환되는 등 모든 알파벳이 소문자로 변환되었다. 반대로 모든 알파벳을 대문자로 변환하고자 할 경우 <code class="docutils literal notranslate"><span class="pre">upper</span></code> 함수를 사용하면 된다.</p>
</div>
<div class="section" id="replace">
<h4><span class="section-number">5.7.3.3. </span><code class="docutils literal notranslate"><span class="pre">replace</span></code>: 문자를 변경<a class="headerlink" href="#replace" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">replace</span></code> 함수는 문자열 안에 있는 일부 문자를 다른 문자열로 변경하며, <code class="docutils literal notranslate"><span class="pre">replace(대상</span> <span class="pre">문자열,</span> <span class="pre">치환</span> <span class="pre">전</span> <span class="pre">문자열,</span> <span class="pre">치환</span> <span class="pre">후</span> <span class="pre">문자열)</span></code> 형태로 입력한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">str1</span><span class="p">,</span> <span class="n">str2</span><span class="p">,</span> <span class="n">str3</span><span class="p">,</span>
	<span class="n">replace</span><span class="p">(</span><span class="n">str1</span><span class="p">,</span> <span class="n">str2</span><span class="p">,</span> <span class="n">str3</span><span class="p">)</span> <span class="k">as</span> <span class="n">rep_str</span>
<span class="kn">from</span> <span class="nn">SampleStr</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="id32">
<img alt="_images/replace.png" src="_images/replace.png" />
<p class="caption"><span class="caption-number">Fig. 5.44 </span><span class="caption-text">replace 함수</span><a class="headerlink" href="#id32" title="Permalink to this image">¶</a></p>
</div>
<p>str1열 중 str2열에 해당하는 문자가 있을 경우 str3열의 문자로 변경된다.</p>
</div>
</div>
<div class="section" id="id33">
<h3><span class="section-number">5.7.4. </span>날짜 함수<a class="headerlink" href="#id33" title="Permalink to this headline">¶</a></h3>
<p>SQL에는 날짜를 다루는 많은 함수가 있으며, DBMS 종류마다 그 형태가 약간씩 다르다.</p>
<div class="section" id="id34">
<h4><span class="section-number">5.7.4.1. </span>현재 날짜, 시간, 일시<a class="headerlink" href="#id34" title="Permalink to this headline">¶</a></h4>
<p>현재 날짜(<code class="docutils literal notranslate"><span class="pre">current_date</span></code>)와 시간(<code class="docutils literal notranslate"><span class="pre">current_time</span></code>), 일시(<code class="docutils literal notranslate"><span class="pre">current_timestamp</span></code>)를 다루는 함수의 경우 from 구문이 없이 사용이 가능하다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">current_date</span><span class="p">,</span> <span class="n">current_time</span><span class="p">,</span> <span class="n">current_timestamp</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="current">
<img alt="_images/current.png" src="_images/current.png" />
<p class="caption"><span class="caption-number">Fig. 5.45 </span><span class="caption-text">현재 날짜 및 시간 관련 함수</span><a class="headerlink" href="#current" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="id35">
<h4><span class="section-number">5.7.4.2. </span>날짜 요소 추출하기<a class="headerlink" href="#id35" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">extract(날짜</span> <span class="pre">요소</span> <span class="pre">from</span> <span class="pre">날짜)</span></code> 함수를 통해 년, 월, 시, 초 등을 추출할 수 있다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span>
    <span class="n">current_timestamp</span><span class="p">,</span>
    <span class="n">extract</span><span class="p">(</span><span class="n">year</span> <span class="kn">from</span> <span class="nn">current_timestamp</span><span class="p">)</span> <span class="k">as</span> <span class="n">year</span><span class="p">,</span>
    <span class="n">extract</span><span class="p">(</span><span class="n">month</span> <span class="kn">from</span> <span class="nn">current_timestamp</span><span class="p">)</span> <span class="k">as</span> <span class="n">month</span><span class="p">,</span>
    <span class="n">extract</span><span class="p">(</span><span class="n">day</span>	<span class="kn">from</span> <span class="nn">current_timestamp</span><span class="p">)</span> <span class="k">as</span> <span class="n">day</span><span class="p">,</span>
    <span class="n">extract</span><span class="p">(</span><span class="n">hour</span> <span class="kn">from</span> <span class="nn">current_timestamp</span><span class="p">)</span> <span class="k">as</span> <span class="n">hour</span><span class="p">,</span>
    <span class="n">extract</span><span class="p">(</span><span class="n">minute</span> <span class="kn">from</span> <span class="nn">current_timestamp</span><span class="p">)</span> <span class="k">as</span> <span class="n">minute</span><span class="p">,</span>
    <span class="n">extract</span><span class="p">(</span><span class="n">second</span> <span class="kn">from</span> <span class="nn">current_timestamp</span><span class="p">)</span> <span class="k">as</span> <span class="n">second</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="extract">
<img alt="_images/extract.png" src="_images/extract.png" />
<p class="caption"><span class="caption-number">Fig. 5.46 </span><span class="caption-text">날짜 요소 추출하기</span><a class="headerlink" href="#extract" title="Permalink to this image">¶</a></p>
</div>
</div>
</div>
<div class="section" id="id36">
<h3><span class="section-number">5.7.5. </span>술어<a class="headerlink" href="#id36" title="Permalink to this headline">¶</a></h3>
<p>술어란 반환 값이 진리값(TRUE, FALSE, UNKNOWN)인 함수를 가리킨다. 대표적인 예로는 <code class="docutils literal notranslate"><span class="pre">like</span></code>, <code class="docutils literal notranslate"><span class="pre">between</span></code>, <code class="docutils literal notranslate"><span class="pre">is</span> <span class="pre">null</span></code>, <code class="docutils literal notranslate"><span class="pre">in</span></code> 등이 있다.</p>
<div class="section" id="like">
<h4><span class="section-number">5.7.5.1. </span><code class="docutils literal notranslate"><span class="pre">like</span></code>: 문자열 부분 일치<a class="headerlink" href="#like" title="Permalink to this headline">¶</a></h4>
<p>앞에서 문자열을 검색할 때는 등호(=)를 사용했지만, 이는 완전히 일치하는 경우에만 참이 된다. 반면 <code class="docutils literal notranslate"><span class="pre">like</span></code> 술어는 문자열 중 <strong>부분 일치를 검색</strong>할 때 사용한다. 먼저 아래의 테이블을 만들도록 한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">create</span> <span class="n">table</span> <span class="n">SampleLike</span>
<span class="p">(</span><span class="n">strcol</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="ow">not</span> <span class="n">null</span><span class="p">,</span>
<span class="n">primary</span> <span class="n">key</span> <span class="p">(</span><span class="n">strcol</span><span class="p">));</span>

<span class="n">insert</span> <span class="n">into</span> <span class="n">SampleLike</span> <span class="p">(</span><span class="n">strcol</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;abcddd&#39;</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">SampleLike</span> <span class="p">(</span><span class="n">strcol</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;dddabc&#39;</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">SampleLike</span> <span class="p">(</span><span class="n">strcol</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;abdddc&#39;</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">SampleLike</span> <span class="p">(</span><span class="n">strcol</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;abcdd&#39;</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">SampleLike</span> <span class="p">(</span><span class="n">strcol</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;ddabc&#39;</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">SampleLike</span> <span class="p">(</span><span class="n">strcol</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;abddc&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="samplelike">
<img alt="_images/samplelike.png" src="_images/samplelike.png" />
<p class="caption"><span class="caption-number">Fig. 5.47 </span><span class="caption-text">SampleLike 테이블</span><a class="headerlink" href="#samplelike" title="Permalink to this image">¶</a></p>
</div>
<p>일치에는 크게 3가지 종류가 있다.</p>
<ul class="simple">
<li><p>전방 일치: 검색 조건이 되는 문자열이 검색 대상 문자열의 가장 앞에 위치하고 있는 레코드를 선택한다.</p></li>
<li><p>중간 일치: 검색 조건이 되는 문자열이 검색 대상 문자열의 어딘가에 포함되어 있으면 레코드를 검색하며 위치는 어디든 상관없다.</p></li>
<li><p>후방 일치: 검색 조건이 되는 문자열이 검색 대상 문자열의 가장 뒤에 위치하고 있는 레코드를 검색한다.</p></li>
</ul>
<p>먼저 전방 일치 검색은 다음과 같다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">samplelike</span>
<span class="n">where</span> <span class="n">strcol</span> <span class="n">like</span> <span class="s1">&#39;ddd%&#39;</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="find-1">
<img alt="_images/find_1.png" src="_images/find_1.png" />
<p class="caption"><span class="caption-number">Fig. 5.48 </span><span class="caption-text">전방 일치 검색</span><a class="headerlink" href="#find-1" title="Permalink to this image">¶</a></p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">%</span></code>는 “0문자 이상의 임의 문자열” 을 의미하는 특수 기호이며, 위의 예에서 ‘ddd%’는 ‘ddd로 시작하는 모든 문자열’을 의미한다.</p>
<p>다음으로 중간 일치 검색은 다음과 같다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">SampleLike</span>
<span class="n">where</span> <span class="n">strcol</span> <span class="n">like</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">dd%&#39;</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="find-2">
<img alt="_images/find_2.png" src="_images/find_2.png" />
<p class="caption"><span class="caption-number">Fig. 5.49 </span><span class="caption-text">중간 일치 검색</span><a class="headerlink" href="#find-2" title="Permalink to this image">¶</a></p>
</div>
<p>위의 예에서 ‘%ddd%’ 처럼 문자열 처음과 끝을 %로 감쌀 경우 ‘문자열 안에 ddd를 포함하고 있는 모든 문자열’을 나타낸다. <a class="reference internal" href="#find-2"><span class="std std-numref">Fig. 5.49</span></a>의 결과를 살펴보면 ddd로 시작하거나 끝나는, 혹은 문자열 가운데에 ddd가 있는 문자열이 검색된다.</p>
<p>마지막으로 후방 일치 검색을 해보도록 하겠다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">SampleLike</span>
<span class="n">where</span> <span class="n">strcol</span> <span class="n">like</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">dd&#39;</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="find-3">
<img alt="_images/find_3.png" src="_images/find_3.png" />
<p class="caption"><span class="caption-number">Fig. 5.50 </span><span class="caption-text">후방 일치 검색</span><a class="headerlink" href="#find-3" title="Permalink to this image">¶</a></p>
</div>
<p>‘%ddd’의 경우 전방 일치와 반대로 ddd로 끝나는 문자열을 검색한다.</p>
</div>
<div class="section" id="between">
<h4><span class="section-number">5.7.5.2. </span><code class="docutils literal notranslate"><span class="pre">between</span></code>: 범위 검색<a class="headerlink" href="#between" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">between</span></code>은 범위 검색을 수행한다. goods 테이블에서 sell_price가 100원부터 1000원까지인 상품을 선택할 때 <code class="docutils literal notranslate"><span class="pre">between</span></code> 술어를 사용하면 다음과 같이 나타낼 수 있다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">goods</span>
<span class="n">where</span> <span class="n">sell_price</span> <span class="n">between</span> <span class="mi">100</span> <span class="ow">and</span> <span class="mi">1000</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="id37">
<img alt="_images/between.png" src="_images/between.png" />
<p class="caption"><span class="caption-number">Fig. 5.51 </span><span class="caption-text">between 술어</span><a class="headerlink" href="#id37" title="Permalink to this image">¶</a></p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">between</span></code>을 사용할 경우 범위에 해당하는 100과 1000 데이터도 포함한다.</p>
</div>
<div class="section" id="is-null-is-not-null-null">
<h4><span class="section-number">5.7.5.3. </span><code class="docutils literal notranslate"><span class="pre">is</span> <span class="pre">null</span></code>, <code class="docutils literal notranslate"><span class="pre">is</span> <span class="pre">not</span> <span class="pre">null</span></code>: null 데이터 선택<a class="headerlink" href="#is-null-is-not-null-null" title="Permalink to this headline">¶</a></h4>
<p>만일 null이 포함된 행을 선택하려면 어떻게 해야 할까? where 구를 <code class="docutils literal notranslate"><span class="pre">where</span> <span class="pre">buy_price</span> <span class="pre">==</span> <span class="pre">null</span></code> 형식으로 작성하면 될 듯 하지만 해당 쿼리를 실행하면 오류가 발생한다. 이는 null이 비교가 불가능한 특별한 표시어이기 때문이며, 이때는 <code class="docutils literal notranslate"><span class="pre">is</span> <span class="pre">null</span></code> 술어를 사용해야 한다. 먼저 buy_price가 null인 데이터를 선택하는 쿼리는 다음과 같다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">goods</span>
<span class="n">where</span> <span class="n">buy_price</span> <span class="ow">is</span> <span class="n">null</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="ope-isnull">
<img alt="_images/ope_isnull.png" src="_images/ope_isnull.png" />
<p class="caption"><span class="caption-number">Fig. 5.52 </span><span class="caption-text">is null 술어</span><a class="headerlink" href="#ope-isnull" title="Permalink to this image">¶</a></p>
</div>
<p>buy_price가 null인 데이터만 선택된다. 반대로 null이 포함되지 않은 데이터만 선택하고 싶을 때는 <code class="docutils literal notranslate"><span class="pre">is</span> <span class="pre">not</span> <span class="pre">null</span></code> 술어를 사용한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">goods</span>
<span class="n">where</span> <span class="n">buy_price</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">null</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="ope-isnotnull">
<img alt="_images/ope_isnotnull.png" src="_images/ope_isnotnull.png" />
<p class="caption"><span class="caption-number">Fig. 5.53 </span><span class="caption-text">is not null 술어</span><a class="headerlink" href="#ope-isnotnull" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="in">
<h4><span class="section-number">5.7.5.4. </span><code class="docutils literal notranslate"><span class="pre">in</span></code>: 복수의 값을 지정<a class="headerlink" href="#in" title="Permalink to this headline">¶</a></h4>
<p>만일 buy_price가 320, 500, 5000인 상품을 선택할 경우, or을 쓰면 다음과 같이 쿼리를 작성해야 한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">goods</span>
<span class="n">where</span> <span class="n">buy_price</span> <span class="o">=</span> <span class="mi">320</span> 
	<span class="ow">or</span> <span class="n">buy_price</span> <span class="o">=</span> <span class="mi">500</span>
	<span class="ow">or</span> <span class="n">buy_price</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<p>그러나 이러한 나열식의 쿼리는 조건이 많아질수록 길어지고 효율성이 떨어진다. 이 때 사용할 수 있는 것이 <code class="docutils literal notranslate"><span class="pre">in</span></code> 술어로써 <code class="docutils literal notranslate"><span class="pre">in(값</span> <span class="pre">1,</span> <span class="pre">값</span> <span class="pre">2,</span> <span class="pre">…)</span></code> 형태를 통해 간단하게 표현할 수 있다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">goods</span>
<span class="n">where</span> <span class="n">buy_price</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">320</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">5000</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="id38">
<img alt="_images/in.png" src="_images/in.png" />
<p class="caption"><span class="caption-number">Fig. 5.54 </span><span class="caption-text">in 술어</span><a class="headerlink" href="#id38" title="Permalink to this image">¶</a></p>
</div>
<p>반대로 buy_price가 320, 500, 5000이 아닌 데이터만 선택하고 싶을 때는 <code class="docutils literal notranslate"><span class="pre">not</span> <span class="pre">in</span></code> 술어를 사용한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">goods</span>
<span class="n">where</span> <span class="n">buy_price</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">320</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">5000</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="not-in">
<img alt="_images/not_in.png" src="_images/not_in.png" />
<p class="caption"><span class="caption-number">Fig. 5.55 </span><span class="caption-text">not in 술어</span><a class="headerlink" href="#not-in" title="Permalink to this image">¶</a></p>
</div>
</div>
</div>
<div class="section" id="id39">
<h3><span class="section-number">5.7.6. </span><code class="docutils literal notranslate"><span class="pre">case</span></code> 식<a class="headerlink" href="#id39" title="Permalink to this headline">¶</a></h3>
<p>case 식은 경우에 따라 값을 구분하며, 쿼리 형식은 다음과 같다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>case when &lt;평가식 1&gt; then &lt;식 1&gt;
    when &lt;평가식 2&gt; then &lt;식 2&gt;
    when &lt;평가식 3&gt; then &lt;식 3&gt;
        ⋮
    else &lt;식 n&gt;
end
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">goods_name</span><span class="p">,</span> <span class="n">sell_price</span><span class="p">,</span>
	<span class="n">case</span> <span class="n">when</span> <span class="n">sell_price</span> <span class="o">&gt;=</span>  <span class="mi">6000</span> <span class="n">then</span> <span class="s1">&#39;고가&#39;</span>    
		 <span class="n">when</span> <span class="n">sell_price</span> <span class="o">&gt;=</span> <span class="mi">3000</span> <span class="ow">and</span> <span class="n">sell_price</span> <span class="o">&lt;</span> <span class="mi">6000</span> <span class="n">then</span> <span class="s1">&#39;중가&#39;</span>
         <span class="n">when</span> <span class="n">sell_price</span> <span class="o">&lt;</span> <span class="mi">3000</span> <span class="n">then</span> <span class="s1">&#39;저가&#39;</span>
		 <span class="k">else</span> <span class="n">null</span>
<span class="n">end</span> <span class="k">as</span> <span class="n">price_classify</span>
<span class="kn">from</span> <span class="nn">goods</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="id40">
<img alt="_images/case.png" src="_images/case.png" />
<p class="caption"><span class="caption-number">Fig. 5.56 </span><span class="caption-text">case 식</span><a class="headerlink" href="#id40" title="Permalink to this image">¶</a></p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">else</span></code> 구문은 위에서 만족하는 조건이 없을 때의 반환값으로써 생략할 수도 있지만 명시적으로 기술하는 것이 좋으며, <code class="docutils literal notranslate"><span class="pre">end</span></code>는 생략이 불가능하다. 조건에 따른 결과가 end as 뒤에 입력한 ‘price_classify’ 열에 표시된다.</p>
</div>
</div>
<div class="section" id="id41">
<h2><span class="section-number">5.8. </span>테이블의 집합과 결합<a class="headerlink" href="#id41" title="Permalink to this headline">¶</a></h2>
<p>SQL을 사용할 경우 하나의 테이블만 이용해 데이터를 다루는 일은 거의 없으며, 한번에 여러개의 테이블을 더하거나 결합하여 원하는 데이터를 얻을 수 있다. 이번에는 테이블의 집합 연산과 각종 결합 방법에 대해 알아보도록 하겠다.</p>
<div class="section" id="id42">
<h3><span class="section-number">5.8.1. </span>테이블 더하기<a class="headerlink" href="#id42" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">union</span></code> 구문을 사용하면 테이블을 위 아래로 더할 수 있다. 먼저 샘플 테이블(Goods2)을 추가로 만든 후, 데이터를 입력한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">TABLE</span> <span class="n">Goods2</span>
<span class="p">(</span><span class="n">goods_id</span> <span class="n">CHAR</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="n">NOT</span> <span class="n">NULL</span><span class="p">,</span>
 <span class="n">goods_name</span> <span class="n">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="n">NOT</span> <span class="n">NULL</span><span class="p">,</span>
 <span class="n">goods_classify</span> <span class="n">VARCHAR</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span> <span class="n">NOT</span> <span class="n">NULL</span><span class="p">,</span>
 <span class="n">sell_price</span> <span class="n">INTEGER</span><span class="p">,</span>
 <span class="n">buy_price</span> <span class="n">INTEGER</span><span class="p">,</span>
 <span class="n">register_date</span> <span class="n">DATE</span><span class="p">,</span>
 <span class="n">PRIMARY</span> <span class="n">KEY</span> <span class="p">(</span><span class="n">goods_id</span><span class="p">));</span>

<span class="n">insert</span> <span class="n">into</span> <span class="n">Goods2</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;0001&#39;</span><span class="p">,</span> <span class="s1">&#39;티셔츠&#39;</span> <span class="p">,</span><span class="s1">&#39;의류&#39;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="s1">&#39;2020-09-20&#39;</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">Goods2</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;0002&#39;</span><span class="p">,</span> <span class="s1">&#39;펀칭기&#39;</span><span class="p">,</span> <span class="s1">&#39;사무용품&#39;</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">320</span><span class="p">,</span> <span class="s1">&#39;2020-09-11&#39;</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">Goods2</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;0003&#39;</span><span class="p">,</span> <span class="s1">&#39;와이셔츠&#39;</span><span class="p">,</span> <span class="s1">&#39;의류&#39;</span><span class="p">,</span> <span class="mi">4000</span><span class="p">,</span> <span class="mi">2800</span><span class="p">,</span> <span class="n">NULL</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">Goods2</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;0009&#39;</span><span class="p">,</span> <span class="s1">&#39;장갑&#39;</span><span class="p">,</span> <span class="s1">&#39;의류&#39;</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="n">NULL</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">Goods2</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;0010&#39;</span><span class="p">,</span> <span class="s1">&#39;주전자&#39;</span><span class="p">,</span> <span class="s1">&#39;주방용품&#39;</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">1700</span><span class="p">,</span> <span class="s1">&#39;2020-09-20&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="goods2">
<img alt="_images/goods2.png" src="_images/goods2.png" />
<p class="caption"><span class="caption-number">Fig. 5.57 </span><span class="caption-text">Goods2 테이블</span><a class="headerlink" href="#goods2" title="Permalink to this image">¶</a></p>
</div>
<p>기존의 Goods 테이블과 새로 만든 Goods2 테이블을 위아래로 합쳐보도록 한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">goods</span>
<span class="n">union</span>
<span class="n">select</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">goods2</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="union-1">
<img alt="_images/union_1.png" src="_images/union_1.png" />
<p class="caption"><span class="caption-number">Fig. 5.58 </span><span class="caption-text">테이블 합치기</span><a class="headerlink" href="#union-1" title="Permalink to this image">¶</a></p>
</div>
<p>상품ID가 001, 002, 003인 3개 행은 양쪽 테이블에 모두 존재하며, <code class="docutils literal notranslate"><span class="pre">union</span></code> 구문에서는 중복행을 제외하고 테이블을 합쳤다. 만일 중복 행을 포함하여 테이블을 합치고자 할 경우에는 <code class="docutils literal notranslate"><span class="pre">union</span> <span class="pre">all</span></code> 구문을 사용하면 된다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">goods</span>
<span class="n">union</span> <span class="nb">all</span>
<span class="n">select</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">goods2</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="union-2">
<img alt="_images/union_2.png" src="_images/union_2.png" />
<p class="caption"><span class="caption-number">Fig. 5.59 </span><span class="caption-text">테이블 합치기 (중복 행 포함)</span><a class="headerlink" href="#union-2" title="Permalink to this image">¶</a></p>
</div>
<p>이처럼 집합 연산을 사용할 때의 주의점은 다음과 같다.</p>
<ul class="simple">
<li><p>연산 대상이 되는 레코드의 열 갯수가 같아야 한다.</p></li>
<li><p>덧셈 대상이 되는 레코드의 열이 같은 데이터형이어야 한다.</p></li>
<li><p>order by 구는 마지막에 하나만 사용 가능하다.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>공통 부분을 선택하는 교집합이나 레코드 뺄셈을 하는 여집합의 경우 타 DBMS에서는 각각 <code class="docutils literal notranslate"><span class="pre">intersect</span></code>와 <code class="docutils literal notranslate"><span class="pre">except</span></code> 구문을 사용하면 되지만, MySQL에서는 아직 이를 지원하지 않는다.</p>
</div>
</div>
<div class="section" id="id43">
<h3><span class="section-number">5.8.2. </span>테이블 결합<a class="headerlink" href="#id43" title="Permalink to this headline">¶</a></h3>
<p>앞서 살펴 본 <code class="docutils literal notranslate"><span class="pre">union</span></code> 은 행으로 테이블을 합치는 것이었다. 이번에 살펴 볼 결합(<code class="docutils literal notranslate"><span class="pre">join</span></code>)은 다른 테이블에서 열을 가지고 와 <strong>열을 늘리는</strong> 작업을 한다. 실무에서는 원하는 데이터가 여러 테이블에 분산되어 있는 경우가 많으므로, 테이블을 결합하여 사용해야 한다. <code class="docutils literal notranslate"><span class="pre">join</span></code>을 시각화하면 다음과 같다.</p>
<div class="figure align-default" id="join">
<img alt="_images/join1.png" src="_images/join1.png" />
<p class="caption"><span class="caption-number">Fig. 5.60 </span><span class="caption-text">테이블 결합 방법들</span><a class="headerlink" href="#join" title="Permalink to this image">¶</a></p>
</div>
<p>먼저 아래의 테이블(StoreGoods)을 만든다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">TABLE</span> <span class="n">StoreGoods</span>
<span class="p">(</span><span class="n">store_id</span> <span class="n">CHAR</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="n">NOT</span> <span class="n">NULL</span><span class="p">,</span>
 <span class="n">store_name</span> <span class="n">VARCHAR</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span> <span class="n">NOT</span> <span class="n">NULL</span><span class="p">,</span>
 <span class="n">goods_id</span> <span class="n">CHAR</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="n">NOT</span> <span class="n">NULL</span><span class="p">,</span>
 <span class="n">num</span> <span class="n">INTEGER</span> <span class="n">NOT</span> <span class="n">NULL</span><span class="p">,</span>
 <span class="n">PRIMARY</span> <span class="n">KEY</span> <span class="p">(</span><span class="n">store_id</span><span class="p">,</span> <span class="n">goods_id</span><span class="p">));</span>

<span class="n">insert</span> <span class="n">into</span> <span class="n">StoreGoods</span> <span class="p">(</span><span class="n">store_id</span><span class="p">,</span> <span class="n">store_name</span><span class="p">,</span> <span class="n">goods_id</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;000A&#39;</span><span class="p">,</span> <span class="s1">&#39;서울&#39;</span><span class="p">,</span>	<span class="s1">&#39;0001&#39;</span><span class="p">,</span>	<span class="mi">30</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">StoreGoods</span> <span class="p">(</span><span class="n">store_id</span><span class="p">,</span> <span class="n">store_name</span><span class="p">,</span> <span class="n">goods_id</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;000A&#39;</span><span class="p">,</span> <span class="s1">&#39;서울&#39;</span><span class="p">,</span>	<span class="s1">&#39;0002&#39;</span><span class="p">,</span>	<span class="mi">50</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">StoreGoods</span> <span class="p">(</span><span class="n">store_id</span><span class="p">,</span> <span class="n">store_name</span><span class="p">,</span> <span class="n">goods_id</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;000A&#39;</span><span class="p">,</span> <span class="s1">&#39;서울&#39;</span><span class="p">,</span>	<span class="s1">&#39;0003&#39;</span><span class="p">,</span>	<span class="mi">15</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">StoreGoods</span> <span class="p">(</span><span class="n">store_id</span><span class="p">,</span> <span class="n">store_name</span><span class="p">,</span> <span class="n">goods_id</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;000B&#39;</span><span class="p">,</span> <span class="s1">&#39;대전&#39;</span><span class="p">,</span>	<span class="s1">&#39;0002&#39;</span><span class="p">,</span>	<span class="mi">30</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">StoreGoods</span> <span class="p">(</span><span class="n">store_id</span><span class="p">,</span> <span class="n">store_name</span><span class="p">,</span> <span class="n">goods_id</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;000B&#39;</span><span class="p">,</span><span class="s1">&#39; 대전&#39;</span><span class="p">,</span>	<span class="s1">&#39;0003&#39;</span><span class="p">,</span>	<span class="mi">120</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">StoreGoods</span> <span class="p">(</span><span class="n">store_id</span><span class="p">,</span> <span class="n">store_name</span><span class="p">,</span> <span class="n">goods_id</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;000B&#39;</span><span class="p">,</span> <span class="s1">&#39;대전&#39;</span><span class="p">,</span>	<span class="s1">&#39;0004&#39;</span><span class="p">,</span>	<span class="mi">20</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">StoreGoods</span> <span class="p">(</span><span class="n">store_id</span><span class="p">,</span> <span class="n">store_name</span><span class="p">,</span> <span class="n">goods_id</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;000B&#39;</span><span class="p">,</span> <span class="s1">&#39;대전&#39;</span><span class="p">,</span>	<span class="s1">&#39;0006&#39;</span><span class="p">,</span>	<span class="mi">10</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">StoreGoods</span> <span class="p">(</span><span class="n">store_id</span><span class="p">,</span> <span class="n">store_name</span><span class="p">,</span> <span class="n">goods_id</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;000B&#39;</span><span class="p">,</span> <span class="s1">&#39;대전&#39;</span><span class="p">,</span>	<span class="s1">&#39;0007&#39;</span><span class="p">,</span>	<span class="mi">40</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">StoreGoods</span> <span class="p">(</span><span class="n">store_id</span><span class="p">,</span> <span class="n">store_name</span><span class="p">,</span> <span class="n">goods_id</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;000C&#39;</span><span class="p">,</span> <span class="s1">&#39;부산&#39;</span><span class="p">,</span>	<span class="s1">&#39;0003&#39;</span><span class="p">,</span>	<span class="mi">20</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">StoreGoods</span> <span class="p">(</span><span class="n">store_id</span><span class="p">,</span> <span class="n">store_name</span><span class="p">,</span> <span class="n">goods_id</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;000C&#39;</span><span class="p">,</span> <span class="s1">&#39;부산&#39;</span><span class="p">,</span>	<span class="s1">&#39;0004&#39;</span><span class="p">,</span>	<span class="mi">50</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">StoreGoods</span> <span class="p">(</span><span class="n">store_id</span><span class="p">,</span> <span class="n">store_name</span><span class="p">,</span> <span class="n">goods_id</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;000C&#39;</span><span class="p">,</span> <span class="s1">&#39;부산&#39;</span><span class="p">,</span>	<span class="s1">&#39;0006&#39;</span><span class="p">,</span>	<span class="mi">90</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">StoreGoods</span> <span class="p">(</span><span class="n">store_id</span><span class="p">,</span> <span class="n">store_name</span><span class="p">,</span> <span class="n">goods_id</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;000C&#39;</span><span class="p">,</span> <span class="s1">&#39;부산&#39;</span><span class="p">,</span>	<span class="s1">&#39;0007&#39;</span><span class="p">,</span>	<span class="mi">70</span><span class="p">);</span>
<span class="n">insert</span> <span class="n">into</span> <span class="n">StoreGoods</span> <span class="p">(</span><span class="n">store_id</span><span class="p">,</span> <span class="n">store_name</span><span class="p">,</span> <span class="n">goods_id</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;000D&#39;</span><span class="p">,</span> <span class="s1">&#39;대구&#39;</span><span class="p">,</span>	<span class="s1">&#39;0001&#39;</span><span class="p">,</span>	<span class="mi">100</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="storegoods">
<img alt="_images/StoreGoods.png" src="_images/StoreGoods.png" />
<p class="caption"><span class="caption-number">Fig. 5.61 </span><span class="caption-text">StoreGoods 테이블</span><a class="headerlink" href="#storegoods" title="Permalink to this image">¶</a></p>
</div>
<p>Goods와 StoreGoods 테이블에 있는 열들을 정리하면 다음과 같다.</p>
<table class="colwidths-auto table" id="sample-table-compare">
<caption><span class="caption-number">Table 5.3 </span><span class="caption-text">샘플 테이블 내 열 비교</span><a class="headerlink" href="#sample-table-compare" title="Permalink to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head"><p>Goods와</p></th>
<th class="head"><p>StoreGoods</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>goods_id (상품ID)</p></td>
<td><p>O</p></td>
<td><p>O</p></td>
</tr>
<tr class="row-odd"><td><p>goods_name (상품명)</p></td>
<td><p>O</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>goods_classify (상품분류)</p></td>
<td><p>O</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>sell_price (판매단가)</p></td>
<td><p>O</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>buy_price (매입단가)</p></td>
<td><p>O</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>register_date (등록일)</p></td>
<td><p>O</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>store_id (점포ID)</p></td>
<td><p></p></td>
<td><p>O</p></td>
</tr>
<tr class="row-odd"><td><p>store_name (점포명)</p></td>
<td><p></p></td>
<td><p>O</p></td>
</tr>
<tr class="row-even"><td><p>num (수량)</p></td>
<td><p></p></td>
<td><p>O</p></td>
</tr>
</tbody>
</table>
<div class="section" id="inner-join">
<h4><span class="section-number">5.8.2.1. </span><code class="docutils literal notranslate"><span class="pre">inner</span> <span class="pre">join</span></code>: 내부 결합<a class="headerlink" href="#inner-join" title="Permalink to this headline">¶</a></h4>
<p>내부 결합(inner join)은 가장 많이 사용되는 결합 방법이다. <a class="reference internal" href="#sample-table-compare"><span class="std std-numref">Table 5.3</span></a>를 살펴보면 goods_id는 두 테이블에 모두 존재하며, 다른 열들은 한쪽 테이블에만 존재한다. 따라서 goods_id를 기준으로 StoreGoods 테이블에 Goods 테이블을 결합하는 방법은 다음과 같으며, 이는 마치 엑셀의 vlookup과도 비슷하다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">store</span><span class="o">.</span><span class="n">store_id</span><span class="p">,</span> <span class="n">store</span><span class="o">.</span><span class="n">store_name</span><span class="p">,</span> <span class="n">store</span><span class="o">.</span><span class="n">goods_id</span><span class="p">,</span>
	<span class="n">goods</span><span class="o">.</span><span class="n">goods_name</span><span class="p">,</span> <span class="n">goods</span><span class="o">.</span><span class="n">sell_price</span>
<span class="kn">from</span> <span class="nn">StoreGoods</span> <span class="k">as</span> <span class="n">store</span> 
<span class="n">inner</span> <span class="n">join</span> <span class="n">Goods</span> <span class="k">as</span> <span class="n">goods</span>
	<span class="n">on</span> <span class="n">store</span><span class="o">.</span><span class="n">goods_id</span> <span class="o">=</span> <span class="n">goods</span><span class="o">.</span><span class="n">goods_id</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="id44">
<img alt="_images/inner_join1.png" src="_images/inner_join1.png" />
<p class="caption"><span class="caption-number">Fig. 5.62 </span><span class="caption-text">inner join</span><a class="headerlink" href="#id44" title="Permalink to this image">¶</a></p>
</div>
<ol class="simple">
<li><p>지금까지는 from에 하나의 테이블만 지정했지만, join 시에는 두 테이블(StoreGoods, Goods)에서 내용을 가지고 온다. 따라서 두 테이블에 store와 goods라는 별명을 붙였다. (원래 테이블명을 그대로 사용해도 되나 테이블명이 길면 가독성이 떨어지므로 일반적으로 별명을 붙인다.)</p></li>
<li><p>on 뒤에 결합 조건을 붙인다. 이는 <code class="docutils literal notranslate"><span class="pre">*</span> <span class="pre">join</span></code> 구문 바로 뒤에 붙이며, store의 goods_id 열과 goods 열의 goods_id 열을 이용해 두 테이블을 연결한다는 의미다.</p></li>
<li><p>select 구에서는 &lt;테이블 별명&gt;.&lt;열 이름&gt; 형식으로 기술한다. 이는 테이블이 여러개가 있으므로, 어느 테이블에서 데이터를 가지고 오는지 혼동하는 것을 방지하기 위해서이다.</p></li>
</ol>
</div>
<div class="section" id="outer-join">
<h4><span class="section-number">5.8.2.2. </span><code class="docutils literal notranslate"><span class="pre">outer</span> <span class="pre">join</span></code> 외부 결합<a class="headerlink" href="#outer-join" title="Permalink to this headline">¶</a></h4>
<p>inner join은 두 테이블에 모두 존재하는 데이터를 합쳤지만, outer join은 한쪽 테이블에만 존재하는 데이터도 출력한다. 먼저 StoreGoods와 Goods에 존재하는 상품ID를 검색한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">distinct</span><span class="p">(</span><span class="n">goods_id</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">StoreGoods</span><span class="p">;</span>
<span class="n">select</span> <span class="n">distinct</span><span class="p">(</span><span class="n">goods_id</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">Goods</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>StoreGoods: 0001, 0002, 0003, 0004, 0006, 0007</p></li>
<li><p>Goods: 0001, 0002, 0003, 0004, 0005, 0006, 0007, 0008</p></li>
</ul>
<p>StoreGoods 1~4, 6~7번이, Goods 1번부터 8번까지 상품이 있다. 즉, StoreGoods 5번(압력솥)과 8번(볼펜) ID에 해당하는 물건이 없다. 이제 <code class="docutils literal notranslate"><span class="pre">outer</span> <span class="pre">join</span></code>을 해보도록 한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">store</span><span class="o">.</span><span class="n">store_id</span><span class="p">,</span> <span class="n">store</span><span class="o">.</span><span class="n">store_name</span><span class="p">,</span> <span class="n">goods</span><span class="o">.</span><span class="n">goods_id</span><span class="p">,</span>
	<span class="n">goods</span><span class="o">.</span><span class="n">goods_name</span><span class="p">,</span> <span class="n">goods</span><span class="o">.</span><span class="n">sell_price</span>
<span class="kn">from</span> <span class="nn">StoreGoods</span> <span class="k">as</span> <span class="n">store</span> 
<span class="n">right</span> <span class="n">outer</span> <span class="n">join</span> <span class="n">Goods</span> <span class="k">as</span> <span class="n">goods</span>
	<span class="n">on</span> <span class="n">store</span><span class="o">.</span><span class="n">goods_id</span> <span class="o">=</span> <span class="n">goods</span><span class="o">.</span><span class="n">goods_id</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="outer-join-right">
<img alt="_images/outer_join_right.png" src="_images/outer_join_right.png" />
<p class="caption"><span class="caption-number">Fig. 5.63 </span><span class="caption-text">outer join (right)</span><a class="headerlink" href="#outer-join-right" title="Permalink to this image">¶</a></p>
</div>
<p>goods_id가 5(압력솥)와 8(볼펜)의 경우 StoreGoods 테이블에 데이터가 존재하지 않는다. 즉, 현재 어떤 점포에서도 취급하지 않는 상품이다. <code class="docutils literal notranslate"><span class="pre">inner</span> <span class="pre">join</span></code>은 양쪽 테이블에 모두 존재하는 정보만을 선택하기 때문에 Goods 테이블에만 존재하는 두 상품은 결과로 출력되지 않았다. 반면 <code class="docutils literal notranslate"><span class="pre">outer</span> <span class="pre">join</span></code>은 한쪽 테이블에만 존재해도 누락 없이 모두 출력하며, 정보가 없는 부분은 NULL로 표시한다.</p>
<p>또한 <code class="docutils literal notranslate"><span class="pre">outer</span> <span class="pre">join</span></code>은 어느 쪽 테이블을 마스터로 할 것인지 정해야 한다. 즉 left 혹은 right를 지정해주어야 한다. left를 사용하면 from 구에서 왼쪽에 지정한 테이블을 마스터로 설정하며, right를 사용하면 오른쪽 테이블을 마스터로 한다. 위의 쿼리는 마스터 테이블을 right로 지정하였기에 오른쪽에 해당하는 Goods 테이블의 내용이 모두 출력되고, goods_id를 기준으로 왼쪽에 해당하는 StoreGoods 테이블의 내용이 결합되었다. 위 쿼리를 <code class="docutils literal notranslate"><span class="pre">left</span> <span class="pre">outer</span> <span class="pre">join</span></code> 으로 바꿔보도록 하자.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">store</span><span class="o">.</span><span class="n">store_id</span><span class="p">,</span> <span class="n">store</span><span class="o">.</span><span class="n">store_name</span><span class="p">,</span> <span class="n">goods</span><span class="o">.</span><span class="n">goods_id</span><span class="p">,</span>
	<span class="n">goods</span><span class="o">.</span><span class="n">goods_name</span><span class="p">,</span> <span class="n">goods</span><span class="o">.</span><span class="n">sell_price</span>
<span class="kn">from</span> <span class="nn">StoreGoods</span> <span class="k">as</span> <span class="n">store</span> 
<span class="n">left</span> <span class="n">outer</span> <span class="n">join</span> <span class="n">Goods</span> <span class="k">as</span> <span class="n">goods</span>
	<span class="n">on</span> <span class="n">store</span><span class="o">.</span><span class="n">goods_id</span> <span class="o">=</span> <span class="n">goods</span><span class="o">.</span><span class="n">goods_id</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="outer-join-left">
<img alt="_images/outer_join_left.png" src="_images/outer_join_left.png" />
<p class="caption"><span class="caption-number">Fig. 5.64 </span><span class="caption-text">outer join (left)</span><a class="headerlink" href="#outer-join-left" title="Permalink to this image">¶</a></p>
</div>
<p>마스터 테이블인 StoreGoods에 존재하는 goods_id(1~4, 6~7)는 결합되는 테이블인 Goods에도 모두 존재하므로 이번에는 NULL이 생성되지 않는다. 어떤 테이블을 기준으로 삼아야 하는가를 미리 생각하여 <code class="docutils literal notranslate"><span class="pre">left</span> <span class="pre">outer</span> <span class="pre">join</span></code>을 할지 <code class="docutils literal notranslate"><span class="pre">right</span> <span class="pre">outer</span> <span class="pre">join</span></code>을 할지 결정해야 한다.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>join 할 수 있는 테이블의 갯수는 제한이 없다.</p>
</div>
</div>
</div>
</div>
<div class="section" id="id45">
<h2><span class="section-number">5.9. </span>SQL 고급 처리<a class="headerlink" href="#id45" title="Permalink to this headline">¶</a></h2>
<p>이번에는 마지막으로 순위 계산, 누적합 계산, 소계를 구하는 등 고급 집계 처리를 하는 방법인 윈도우 함수 및 GROUPING 연산자에 대해 배워보겠다.</p>
<div class="section" id="id46">
<h3><span class="section-number">5.9.1. </span>윈도우 함수<a class="headerlink" href="#id46" title="Permalink to this headline">¶</a></h3>
<p>윈도우 함수를 이용하면 랭킹, 순번 생성 등 일반적인 집약 함수로는 불가능한 고급처리를 할 수 있다. 윈도우 함수의 사용법은 크게 다음과 같다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">윈도우</span> <span class="n">함수</span><span class="o">&gt;</span> <span class="n">over</span> <span class="p">([</span><span class="n">partition</span> <span class="n">by</span> <span class="o">&lt;</span><span class="n">열</span> <span class="n">리스트</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">order</span> <span class="n">by</span> <span class="o">&lt;</span><span class="n">정렬용</span> <span class="n">열</span> <span class="n">리스트</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>이 중 <code class="docutils literal notranslate"><span class="pre">partition</span> <span class="pre">by</span></code>는 생략이 가능하다.</p>
<p>윈도우 함수로 사용할 수 있는 함수는 크게 다음과 같다.</p>
<ul class="simple">
<li><p>윈도우 전용 함수: <code class="docutils literal notranslate"><span class="pre">rank</span></code>, <code class="docutils literal notranslate"><span class="pre">dense_rank</span></code>, <code class="docutils literal notranslate"><span class="pre">row_number</span></code> 등</p></li>
<li><p>집약함수: <code class="docutils literal notranslate"><span class="pre">sum</span></code>, <code class="docutils literal notranslate"><span class="pre">avg</span></code>, <code class="docutils literal notranslate"><span class="pre">count</span></code>, <code class="docutils literal notranslate"><span class="pre">max</span></code>, <code class="docutils literal notranslate"><span class="pre">min</span></code> 등</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>윈도우 전용 함수는 원칙적으로 select 구에만 사용할 수 있다.</p>
</div>
<div class="section" id="rank">
<h4><span class="section-number">5.9.1.1. </span><code class="docutils literal notranslate"><span class="pre">rank</span></code>: 순위를 계산<a class="headerlink" href="#rank" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">rank</span></code> 함수는 순위를 구하는 함수다. 예를 들어 Goods 테이블의 상품 중 상품분류(goods_classify) 별로 판매단가(sell_price)가 낮은 순서대로 순위를 구하는 방법은 다음과 같다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">goods_name</span><span class="p">,</span> <span class="n">goods_classify</span><span class="p">,</span> <span class="n">sell_price</span><span class="p">,</span>
	<span class="n">rank</span><span class="p">()</span> <span class="n">over</span> <span class="p">(</span><span class="n">partition</span> <span class="n">by</span> <span class="n">goods_classify</span> <span class="n">order</span> <span class="n">by</span> <span class="n">sell_price</span><span class="p">)</span> <span class="k">as</span> <span class="n">ranking</span>
<span class="kn">from</span> <span class="nn">Goods</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">goods_name</span><span class="p">,</span> <span class="n">goods_classify</span><span class="p">,</span> <span class="n">sell_price</span><span class="p">,</span>
	<span class="n">rank</span> <span class="p">()</span> <span class="n">over</span> <span class="p">(</span><span class="n">order</span> <span class="n">by</span> <span class="n">sell_price</span><span class="p">)</span> <span class="k">as</span> <span class="n">ranking</span>
<span class="kn">from</span> <span class="nn">Goods</span><span class="p">;</span> 
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="rank-2">
<img alt="_images/rank_2.png" src="_images/rank_2.png" />
<p class="caption"><span class="caption-number">Fig. 5.65 </span><span class="caption-text">rank 함수 (전체 기준)</span><a class="headerlink" href="#rank-2" title="Permalink to this image">¶</a></p>
</div>
<p>순위를 구하는 함수는 rank 외에도 다양하게 존재하며, 그 결과가 약간씩 다르다.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">rank</span></code>: 같은 순위인 행이 복수개 있으면 후순위를 건너뛴다.
예) 1위가 3개인 경우: 1위, 1위, 1위, 4위, …</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dense_rank</span></code>: 같은 순위인 행이 복수가 있어도 후순위를 건너뛰지 않는다.
예) 1위가 3개인 경우: 1위, 1위, 1위, 2위, …</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">row_number</span></code>: 순위와 상관없이 연속 번호를 부여한다.
예: 1위가 3개인 레코드인 경우: 1위, 2위, 3위, 4위, …</p></li>
</ul>
<p>각 함수 별 차이를 살펴보도록 하자.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">goods_name</span><span class="p">,</span> <span class="n">goods_classify</span><span class="p">,</span> <span class="n">sell_price</span><span class="p">,</span>
	<span class="n">rank</span><span class="p">()</span> <span class="n">over</span> <span class="p">(</span><span class="n">order</span> <span class="n">by</span> <span class="n">sell_price</span><span class="p">)</span> <span class="k">as</span> <span class="n">ranking</span><span class="p">,</span>
    <span class="n">dense_rank</span><span class="p">()</span> <span class="n">over</span> <span class="p">(</span><span class="n">order</span> <span class="n">by</span> <span class="n">sell_price</span><span class="p">)</span> <span class="k">as</span> <span class="n">ranking</span><span class="p">,</span>
    <span class="n">row_number</span><span class="p">()</span> <span class="n">over</span> <span class="p">(</span><span class="n">order</span> <span class="n">by</span> <span class="n">sell_price</span><span class="p">)</span> <span class="k">as</span> <span class="n">ranking</span>
<span class="kn">from</span> <span class="nn">Goods</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="rank-3">
<img alt="_images/rank_3.png" src="_images/rank_3.png" />
<p class="caption"><span class="caption-number">Fig. 5.66 </span><span class="caption-text">순위를 구하는 함수들</span><a class="headerlink" href="#rank-3" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="id47">
<h4><span class="section-number">5.9.1.2. </span>윈도우 함수에서 집약 함수의 사용<a class="headerlink" href="#id47" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">sum</span></code>이나 <code class="docutils literal notranslate"><span class="pre">avg</span></code>와 같은 집약 함수도 윈도우 함수로 사용할 수 있다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">goods_id</span><span class="p">,</span> <span class="n">goods_name</span><span class="p">,</span> <span class="n">sell_price</span><span class="p">,</span>
	<span class="nb">sum</span><span class="p">(</span><span class="n">sell_price</span><span class="p">)</span> <span class="n">over</span><span class="p">()</span> <span class="k">as</span> <span class="n">current_sum</span>
<span class="kn">from</span> <span class="nn">Goods</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="window-sum">
<img alt="_images/window_sum.png" src="_images/window_sum.png" />
<p class="caption"><span class="caption-number">Fig. 5.67 </span><span class="caption-text">윈도우 함수에서 sum</span><a class="headerlink" href="#window-sum" title="Permalink to this image">¶</a></p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">over()</span></code>를 빈 칸으로 둘 경우 current_sum 열에는 모든 sell_price의 합계가 나타난다. 이번에는 누적합계를 구해보도록 하자.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">goods_id</span><span class="p">,</span> <span class="n">goods_name</span><span class="p">,</span> <span class="n">sell_price</span><span class="p">,</span>
	<span class="nb">sum</span><span class="p">(</span><span class="n">sell_price</span><span class="p">)</span> <span class="n">over</span><span class="p">(</span><span class="n">order</span> <span class="n">by</span> <span class="n">goods_id</span><span class="p">)</span> <span class="k">as</span> <span class="n">current_sum</span>
<span class="kn">from</span> <span class="nn">Goods</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">  File</span><span class="nn"> &quot;C:\Users\DOOMOO~1\AppData\Local\Temp/ipykernel_13644/1732175871.py&quot;</span><span class="gt">, line </span><span class="mi">1</span>
    <span class="n">select</span> <span class="n">goods_id</span><span class="p">,</span> <span class="n">goods_name</span><span class="p">,</span> <span class="n">sell_price</span><span class="p">,</span>
           <span class="o">^</span>
<span class="ne">SyntaxError</span>: invalid syntax
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="window-sum-2">
<img alt="_images/window_sum_2.png" src="_images/window_sum_2.png" />
<p class="caption"><span class="caption-number">Fig. 5.68 </span><span class="caption-text">윈도우 함수에서 sum (누적합계)</span><a class="headerlink" href="#window-sum-2" title="Permalink to this image">¶</a></p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">order</span> <span class="pre">by</span></code>에 열을 지정할 경우 goods_id를 기준으로 오름차순으로 정렬한 후 누적합계를 구한다. 즉 첫번째 행은 1000, 두번째 행은 1000+500=1500, 세번째 행은 1000+500+4000=5500 과 같이 누적해서 합계가 계산되며, 이는 다른 집계함수도 마찬가지이다. 이번에는 누적평균을 계산해보도록 하자.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">goods_id</span><span class="p">,</span> <span class="n">goods_name</span><span class="p">,</span> <span class="n">sell_price</span><span class="p">,</span>
	<span class="n">avg</span><span class="p">(</span><span class="n">sell_price</span><span class="p">)</span> <span class="n">over</span><span class="p">(</span><span class="n">order</span> <span class="n">by</span> <span class="n">goods_id</span><span class="p">)</span> <span class="k">as</span> <span class="n">current_avg</span>
<span class="kn">from</span> <span class="nn">Goods</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="window-avg">
<img alt="_images/window_avg.png" src="_images/window_avg.png" />
<p class="caption"><span class="caption-number">Fig. 5.69 </span><span class="caption-text">윈도우 함수에서 avg (누적평균)</span><a class="headerlink" href="#window-avg" title="Permalink to this image">¶</a></p>
</div>
<p>누적합계와 동일하게 첫번째 행은 (1000)/1=1000, 두번째 행은 (1000+500)/2=750, 세번째 행은 (1000+500+4000)/3=1833.33과 같이 누적해가며 평균을 계산한다.</p>
<p><code class="docutils literal notranslate"><span class="pre">partition</span> <span class="pre">by</span></code>를 추가하면 윈도우 별로 집계도 가능하다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">goods_id</span><span class="p">,</span> <span class="n">goods_classify</span><span class="p">,</span> <span class="n">goods_name</span><span class="p">,</span> <span class="n">sell_price</span><span class="p">,</span>
	<span class="nb">sum</span><span class="p">(</span><span class="n">sell_price</span><span class="p">)</span> <span class="n">over</span><span class="p">(</span><span class="n">partition</span> <span class="n">by</span> <span class="n">goods_classify</span> <span class="n">order</span> <span class="n">by</span> <span class="n">goods_id</span><span class="p">)</span> <span class="k">as</span> <span class="n">current_sum</span>
<span class="kn">from</span> <span class="nn">Goods</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="window-sum-3">
<img alt="_images/window_sum_3.png" src="_images/window_sum_3.png" />
<p class="caption"><span class="caption-number">Fig. 5.70 </span><span class="caption-text">윈도우 별 집계</span><a class="headerlink" href="#window-sum-3" title="Permalink to this image">¶</a></p>
</div>
<p><a class="reference internal" href="#window-sum-3"><span class="std std-numref">Fig. 5.70</span></a>을 보면 partition by에 해당하는 goods_classify 별로(사무용품, 의류, 주방용품) 누적합계가 계산된다.</p>
</div>
<div class="section" id="id48">
<h4><span class="section-number">5.9.1.3. </span>이동평균 계산하기<a class="headerlink" href="#id48" title="Permalink to this headline">¶</a></h4>
<p>윈도우 함수에서는 그 범위를 정해 ‘프레임’을 만들 수도 있다. 이는 <code class="docutils literal notranslate"><span class="pre">over</span></code> 내의 <code class="docutils literal notranslate"><span class="pre">order</span> <span class="pre">by</span></code> 구문 뒤에 범위 지정 키워드를 사용하면 된다. 예를 들어 모든 열에 대한 누적평균이 아닌 최근 3개 데이터만 이용해 평균을 구하는 이동평균을 계산하는 쿼리는 다음과 같다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">goods_id</span><span class="p">,</span> <span class="n">goods_classify</span><span class="p">,</span> <span class="n">goods_name</span><span class="p">,</span> <span class="n">sell_price</span><span class="p">,</span>
	<span class="n">avg</span><span class="p">(</span><span class="n">sell_price</span><span class="p">)</span> <span class="n">over</span><span class="p">(</span><span class="n">order</span> <span class="n">by</span> <span class="n">goods_id</span> <span class="n">rows</span> <span class="mi">2</span> <span class="n">preceding</span><span class="p">)</span> <span class="k">as</span> <span class="n">moving_avg</span>
<span class="kn">from</span> <span class="nn">Goods</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="window-ma">
<img alt="_images/window_ma.png" src="_images/window_ma.png" />
<p class="caption"><span class="caption-number">Fig. 5.71 </span><span class="caption-text">이동평균 계산하기</span><a class="headerlink" href="#window-ma" title="Permalink to this image">¶</a></p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">rows</span> <span class="pre">n</span> <span class="pre">proceding</span></code>을 입력할 경우 앞의 n 행까지만 프레임을 만들어 계산한다. 위 예제에서는 n=2를 입력했으므로 현재 행과 앞의 두개 행, 즉 3개 행으로만 이동평균을 계산한다. <a class="reference internal" href="#window-ma"><span class="std std-numref">Fig. 5.71</span></a>의 결과를 살펴보면 1행과 2행은 앞의 두개 행에 해당하는 데이터가 없으므로 존재하는 데이터들로 평균이 계산된다. 3행은 1~3행을 이용해 평균이 계산되며 4행은 2~4행, 5행은 3~5행 등 프레임이 움직이며 이동평균이 계산된다.</p>
<p>앞의 행이 아닌 뒤의 행을 이용해 계산하고 싶을 경우 <code class="docutils literal notranslate"><span class="pre">preceding</span></code> 대신 <code class="docutils literal notranslate"><span class="pre">following</span></code>을 입력한다. 현재 행과 뒤의 두개 행으로 이동평균을 계산하는 법은 다음과 같다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">goods_id</span><span class="p">,</span> <span class="n">goods_classify</span><span class="p">,</span> <span class="n">goods_name</span><span class="p">,</span> <span class="n">sell_price</span><span class="p">,</span>
	<span class="n">avg</span><span class="p">(</span><span class="n">sell_price</span><span class="p">)</span> <span class="n">over</span><span class="p">(</span><span class="n">order</span> <span class="n">by</span> <span class="n">goods_id</span> <span class="n">rows</span> <span class="n">between</span> <span class="n">current</span> <span class="n">row</span> <span class="ow">and</span> <span class="mi">2</span> <span class="n">following</span><span class="p">)</span> <span class="k">as</span> <span class="n">moving_avg</span>
<span class="kn">from</span> <span class="nn">Goods</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="window-ma-2">
<img alt="_images/window_ma_2.png" src="_images/window_ma_2.png" />
<p class="caption"><span class="caption-number">Fig. 5.72 </span><span class="caption-text">이동평균 계산하기 (2)</span><a class="headerlink" href="#window-ma-2" title="Permalink to this image">¶</a></p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">current</span> <span class="pre">row</span> <span class="pre">and</span> <span class="pre">2</span> <span class="pre">following</span></code>는 현재 행과 뒤의 두개 행을 의미하며, 앞서 살펴 본 <code class="docutils literal notranslate"><span class="pre">preceding</span></code>과 반대로 뒤에서 부터 이동평균의 계산된다. <code class="docutils literal notranslate"><span class="pre">preceding</span></code>과 <code class="docutils literal notranslate"><span class="pre">following</span></code>을 동시에 사용하는 것도 가능하다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">goods_id</span><span class="p">,</span> <span class="n">goods_classify</span><span class="p">,</span> <span class="n">goods_name</span><span class="p">,</span> <span class="n">sell_price</span><span class="p">,</span>
	<span class="n">avg</span><span class="p">(</span><span class="n">sell_price</span><span class="p">)</span> <span class="n">over</span><span class="p">(</span><span class="n">order</span> <span class="n">by</span> <span class="n">goods_id</span>
    <span class="n">rows</span> <span class="n">between</span> <span class="mi">1</span> <span class="n">preceding</span> <span class="ow">and</span> <span class="mi">1</span> <span class="n">following</span><span class="p">)</span>
    <span class="k">as</span> <span class="n">moving_avg</span>
<span class="kn">from</span> <span class="nn">goods</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="window-ma-3">
<img alt="_images/window_ma_2.png" src="_images/window_ma_2.png" />
<p class="caption"><span class="caption-number">Fig. 5.73 </span><span class="caption-text">이동평균 계산하기 (3)</span><a class="headerlink" href="#window-ma-3" title="Permalink to this image">¶</a></p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">rows</span> <span class="pre">between</span> <span class="pre">n</span> <span class="pre">preceding</span> <span class="pre">and</span> <span class="pre">m</span> <span class="pre">following</span></code>을 입력하면 앞의 n행과 뒤의 m행 까지를 프레임으로 지정한다. 위의 예에서는 앞의 1개 행과 뒤의 1개 행, 총 3개 행을 이용해 이동평균이 계산된다.</p>
</div>
</div>
<div class="section" id="grouping">
<h3><span class="section-number">5.9.2. </span>GROUPING 연산자<a class="headerlink" href="#grouping" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">group</span> <span class="pre">by</span></code> 구와 집약 함수만으로는 소계나 합계를 동시에 구할 수 없다. 예를 들어 group by로 합계를 구할 경우, 각 그룹의 합을 구할 수는 있지만 전체 합을 나타낼 수는 없다. 이를 한번에 구하는 기능이 grouping 연산자이다.</p>
<p>먼저 그룹(상품 분류)별 sell_price의 합계를 구하는 법은 다음과 같다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">goods_classify</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">sell_price</span><span class="p">)</span> <span class="k">as</span> <span class="n">sum_price</span>
<span class="kn">from</span> <span class="nn">Goods</span>
<span class="n">group</span> <span class="n">by</span> <span class="n">goods_classify</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="group-sum">
<img alt="_images/group_sum.png" src="_images/group_sum.png" />
<p class="caption"><span class="caption-number">Fig. 5.74 </span><span class="caption-text">그룹 별 합계 구하기</span><a class="headerlink" href="#group-sum" title="Permalink to this image">¶</a></p>
</div>
<p>만일 전체 합계에 해당하는 소계를 추가하고자 할 경우 <code class="docutils literal notranslate"><span class="pre">group</span> <span class="pre">by</span> <span class="pre">[열</span> <span class="pre">이름1]</span></code> 뒤에 <code class="docutils literal notranslate"><span class="pre">with</span> <span class="pre">rollup</span></code> 구문을 추가해준다. (해당 구문은 DBMS 별로 다르다.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">goods_classify</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">sell_price</span><span class="p">)</span> <span class="k">as</span> <span class="n">sum_price</span>
<span class="kn">from</span> <span class="nn">Goods</span>
<span class="n">group</span> <span class="n">by</span> <span class="n">goods_classify</span> <span class="k">with</span> <span class="n">rollup</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="rollup">
<img alt="_images/rollup.png" src="_images/rollup.png" />
<p class="caption"><span class="caption-number">Fig. 5.75 </span><span class="caption-text">소계 구하기</span><a class="headerlink" href="#rollup" title="Permalink to this image">¶</a></p>
</div>
<p>하단의 NULL에 600+5000+11180에 해당하는 소계 16780 이 계산된다. 이러한 초집합행(super group row)의 집약 키는 기본값으로 null이 사용된다. 하나의 기준이 아닌 여러 기준을 입력할 경우 각각의 소계 및 전체 합계가 구해진다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">goods_classify</span><span class="p">,</span> <span class="n">register_date</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">sell_price</span><span class="p">)</span> <span class="k">as</span> <span class="n">sum_price</span>
<span class="kn">from</span> <span class="nn">Goods</span>
<span class="n">group</span> <span class="n">by</span> <span class="n">goods_classify</span><span class="p">,</span> <span class="n">register_date</span> <span class="k">with</span> <span class="n">rollup</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="rollup-2">
<img alt="_images/rollup_2.png" src="_images/rollup_2.png" />
<p class="caption"><span class="caption-number">Fig. 5.76 </span><span class="caption-text">소계 및 합계 구하기</span><a class="headerlink" href="#rollup-2" title="Permalink to this image">¶</a></p>
</div>
<p>goods_classify와 register_date를 기준으로 그룹을 나누어 합계 및 소계가 구해지며, 가장 하단에는 전체 합계가 구해진다. 이는 엑셀의 피벗 기능과도 비슷하다.</p>
<p>의류를 살펴보면 register_date가 NULL인 항목이 2개가 존재한다. ① sum_price가 4000인 값은 원래 데이터에서 와이셔츠의 등록일이 NULL이므로 집약 키가 NULL이 사용된 것이며, ② sum_price가 5000인 값은 초집합행(소계)에 해당(1000+4000)하는 값이다. 그러나 한눈에 보기에 둘은 헷갈릴 수 있으므로, 혼동을 방지하기 위해 초집합행(소계)의 NULL을 판별할 수 있는 <code class="docutils literal notranslate"><span class="pre">grouping</span></code> 함수가 존재한다. 해당 함수는 인수로 지정한 열의 값이 초집합행 NULL인 경우 1을, 이외의 값이면 0을 반환한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">grouping</span><span class="p">(</span><span class="n">goods_classify</span><span class="p">),</span> <span class="n">grouping</span><span class="p">(</span><span class="n">register_date</span><span class="p">),</span> <span class="nb">sum</span><span class="p">(</span><span class="n">sell_price</span><span class="p">)</span> <span class="k">as</span> <span class="n">sum_price</span>
<span class="kn">from</span> <span class="nn">goods</span>
<span class="n">group</span> <span class="n">by</span> <span class="n">goods_classify</span><span class="p">,</span> <span class="n">register_date</span> <span class="k">with</span> <span class="n">rollup</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="group-2">
<img alt="_images/group_2.png" src="_images/group_2.png" />
<p class="caption"><span class="caption-number">Fig. 5.77 </span><span class="caption-text">grouping 함수</span><a class="headerlink" href="#group-2" title="Permalink to this image">¶</a></p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">grouping</span></code> 함수를 통해 초집합행 NULL과 원래 데이터가 NULL인 것을 구분할 수 있다. 이제 앞서 배웠던 case 문을 이용하면 초집합행 키 값과 열 이름을 구분할 수 있다. 즉 grouping 값이 1인 경우 ‘합계’ 혹은 ‘소계’와 같은 문자열을 지정하며, 0인 경우는 그룹 기준에 해당하는 열 이름을 지정한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">case</span> <span class="n">when</span> <span class="n">grouping</span><span class="p">(</span><span class="n">goods_classify</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span>
		<span class="n">then</span> <span class="s1">&#39;상품분류 합계&#39;</span>
		<span class="k">else</span> <span class="n">goods_classify</span> <span class="n">end</span> <span class="k">as</span> <span class="n">goods_classify</span><span class="p">,</span>
    <span class="n">case</span> <span class="n">when</span> <span class="n">grouping</span><span class="p">(</span><span class="n">register_date</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span>
		<span class="n">then</span> <span class="s1">&#39;등록일 합계&#39;</span>
		<span class="k">else</span> <span class="n">register_date</span> <span class="n">end</span> <span class="k">as</span> <span class="n">register_date</span><span class="p">,</span>
	<span class="nb">sum</span><span class="p">(</span><span class="n">sell_price</span><span class="p">)</span> <span class="k">as</span> <span class="n">sum_price</span>
<span class="kn">from</span> <span class="nn">Goods</span>
<span class="n">group</span> <span class="n">by</span> <span class="n">goods_classify</span><span class="p">,</span> <span class="n">register_date</span> <span class="k">with</span> <span class="n">rollup</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="group-3">
<img alt="_images/group_3.png" src="_images/group_3.png" />
<p class="caption"><span class="caption-number">Fig. 5.78 </span><span class="caption-text">grouping 함수를 이용한 정리</span><a class="headerlink" href="#group-3" title="Permalink to this image">¶</a></p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">case</span> <span class="pre">when</span></code> 구문을 통해 <code class="docutils literal notranslate"><span class="pre">grouping</span></code> 결과가 1이면 ‘상품분류 합계’ 혹은 ‘등록일 합계’를 출력하며, 그렇지 않으면 원래의 열 이름이 나타나게 한다. 이를 통해 소계와 합계를 더욱 쉽게 구분할 수 있다.</p>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="plot.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">4. </span>데이터 시각화 배워보기</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="sql_in_python.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">6. </span>파이썬에서 SQL 연결하기</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By 이현열<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>